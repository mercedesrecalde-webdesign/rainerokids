<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
  <title>Rainero Kids - Culinaria 4.0</title>
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#7B2D8E">
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="apple-touch-icon.png">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=Nunito:wght@700;800;900&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
:root {
  /* Colores Vicente L√≥pez */
  --violet: #7B2D8E;
  --violet-light: #9B4DB8;
  --violet-dark: #5A1F6A;
  --green: #7AB929;
  --green-light: #9AD649;
  --green-dark: #5A8A1F;
  --teal: #00A19A;
  --teal-light: #00C4BC;
  --teal-dark: #007A75;
  
  /* Accent colors */
  --accent: #F59E0B;
  --success: #10B981;
  --danger: #EF4444;
  --pink: #EC4899;
  
  /* Gradients */
  --grad-main: linear-gradient(135deg, #7B2D8E 0%, #00A19A 50%, #7AB929 100%);
  --grad-violet: linear-gradient(135deg, #7B2D8E, #9B4DB8);
  --grad-green: linear-gradient(135deg, #7AB929, #9AD649);
  --grad-teal: linear-gradient(135deg, #00A19A, #00C4BC);
  
  /* UI */
  --bg: #F0F4F8;
  --bg-card: rgba(255,255,255,0.95);
  --bg-card-hover: rgba(255,255,255,1);
  --text: #1E293B;
  --text-secondary: #64748B;
  --text-muted: #94A3B8;
  --border: rgba(0,0,0,0.08);
  --shadow: 0 4px 20px rgba(123,45,142,0.1);
  --shadow-lg: 0 20px 40px rgba(123,45,142,0.15);
  --glow-violet: 0 0 40px rgba(123,45,142,0.3);
  --glow-green: 0 0 40px rgba(122,185,41,0.3);
  --glow-teal: 0 0 40px rgba(0,161,154,0.3);
  
  --radius: 16px;
  --radius-lg: 24px;
  --radius-full: 9999px;
  --transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  --bounce: cubic-bezier(0.68, -0.55, 0.265, 1.55);
  --safe-bottom: env(safe-area-inset-bottom, 0px);
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: 'Inter', -apple-system, sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100dvh;
  overflow-x: hidden;
  -webkit-font-smoothing: antialiased;
}

/* Animated Gradient Background */
.bg-gradient {
  position: fixed;
  inset: 0;
  z-index: -1;
  background: linear-gradient(-45deg, #E8F5E9, #E1F5FE, #F3E5F5, #E0F2F1, #FFF8E1);
  background-size: 400% 400%;
  animation: gradientMove 15s ease infinite;
}
@keyframes gradientMove {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

/* Floating shapes */
.bg-shapes {
  position: fixed;
  inset: 0;
  z-index: -1;
  overflow: hidden;
  pointer-events: none;
}
.shape {
  position: absolute;
  border-radius: 50%;
  filter: blur(60px);
  opacity: 0.5;
  animation: float 20s ease-in-out infinite;
}
.shape-1 { width: 400px; height: 400px; background: var(--violet); top: -10%; left: -10%; animation-delay: 0s; }
.shape-2 { width: 350px; height: 350px; background: var(--teal); top: 60%; right: -15%; animation-delay: -5s; }
.shape-3 { width: 300px; height: 300px; background: var(--green); bottom: -10%; left: 30%; animation-delay: -10s; }
@keyframes float {
  0%, 100% { transform: translate(0, 0) scale(1); }
  25% { transform: translate(30px, -30px) scale(1.05); }
  50% { transform: translate(-20px, 20px) scale(0.95); }
  75% { transform: translate(20px, 30px) scale(1.02); }
}

.hidden { display: none !important; }
h1, h2, h3, h4 { font-family: 'Nunito', sans-serif; font-weight: 800; }

/* ==================== AVATAR CARDS ==================== */
.avatar-card {
  position: relative;
  background: var(--bg-card);
  border: 2px solid transparent;
  border-radius: var(--radius-lg);
  padding: 28px 20px;
  text-align: center;
  cursor: pointer;
  transition: var(--transition);
  overflow: hidden;
  backdrop-filter: blur(20px);
  box-shadow: var(--shadow);
}
.avatar-card::before {
  content: '';
  position: absolute;
  inset: -2px;
  background: var(--card-gradient);
  border-radius: var(--radius-lg);
  z-index: -1;
  opacity: 0;
  transition: var(--transition);
}
.avatar-card:hover {
  transform: translateY(-8px) scale(1.02);
  box-shadow: var(--shadow-lg), var(--card-glow);
}
.avatar-card:hover::before { opacity: 1; }
.avatar-card:active { transform: scale(0.98); }

.avatar-illustration {
  width: 90px;
  height: 90px;
  margin: 0 auto 16px;
  position: relative;
}
.avatar-illustration svg {
  width: 100%;
  height: 100%;
  filter: drop-shadow(0 8px 16px rgba(0,0,0,0.15));
  transition: var(--transition);
}
.avatar-card:hover .avatar-illustration svg {
  transform: scale(1.1) rotate(3deg);
}
.avatar-card h3 {
  font-size: 1.2rem;
  color: var(--text);
  margin-bottom: 4px;
}
.avatar-card p {
  font-size: 0.85rem;
  color: var(--text-secondary);
}
.avatar-card .age-badge {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  margin-top: 12px;
  padding: 6px 14px;
  background: var(--card-gradient);
  border-radius: var(--radius-full);
  font-size: 0.75rem;
  font-weight: 700;
  color: white;
}

.avatar-card.kids { --card-gradient: var(--grad-green); --card-glow: var(--glow-green); }
.avatar-card.teens { --card-gradient: var(--grad-violet); --card-glow: var(--glow-violet); }
.avatar-card.parents { --card-gradient: var(--grad-teal); --card-glow: var(--glow-teal); }
.avatar-card.docente { --card-gradient: linear-gradient(135deg, #F59E0B, #D97706); --card-glow: 0 0 40px rgba(245,158,11,0.3); }

/* ==================== PORTAL ==================== */
.portal {
  min-height: 100dvh;
  display: flex;
  flex-direction: column;
  padding: 20px;
}
.portal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 0;
}
.logo-badge {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px 16px;
  background: var(--bg-card);
  border-radius: var(--radius-full);
  box-shadow: var(--shadow);
}
.logo-badge img { height: 26px; }
.logo-badge span { font-weight: 700; font-size: 0.85rem; color: var(--violet); }
.portal-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 20px 0;
}
.hero-logo {
  width: 130px;
  height: 130px;
  border-radius: 50%;
  object-fit: cover;
  border: 4px solid white;
  box-shadow: var(--shadow-lg), 0 0 0 8px rgba(123,45,142,0.1);
  animation: float 4s ease-in-out infinite, pulseGlow 3s ease-in-out infinite alternate;
  margin-bottom: 24px;
}
@keyframes pulseGlow {
  from { box-shadow: var(--shadow-lg), 0 0 0 8px rgba(123,45,142,0.1); }
  to { box-shadow: var(--shadow-lg), 0 0 30px rgba(123,45,142,0.3), 0 0 0 12px rgba(123,45,142,0.15); }
}
.hero-title {
  text-align: center;
  margin-bottom: 36px;
}
.hero-title h1 {
  font-size: 2.6rem;
  background: var(--grad-main);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  letter-spacing: -1px;
  margin-bottom: 8px;
}
.hero-title p {
  font-size: 1.05rem;
  color: var(--text-secondary);
  font-weight: 500;
}
.portal-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 16px;
  max-width: 420px;
  width: 100%;
}
.portal-footer {
  text-align: center;
  padding: 20px;
  color: var(--text-muted);
  font-size: 0.8rem;
}

/* ==================== LOGIN / REGISTER ==================== */
.login-screen {
  min-height: 100dvh;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 24px;
}
.login-card {
  background: var(--bg-card);
  border-radius: var(--radius-lg);
  padding: 36px 28px;
  width: 100%;
  max-width: 400px;
  box-shadow: var(--shadow-lg);
  animation: slideUp 0.5s var(--bounce);
}
@keyframes slideUp {
  from { opacity: 0; transform: translateY(30px); }
  to { opacity: 1; transform: translateY(0); }
}
.login-header {
  text-align: center;
  margin-bottom: 28px;
}
.login-avatar {
  width: 80px;
  height: 80px;
  margin: 0 auto 16px;
}
.login-avatar svg { width: 100%; height: 100%; }
.login-header h2 {
  font-size: 1.5rem;
  margin-bottom: 6px;
}
.login-header p {
  color: var(--text-secondary);
  font-size: 0.9rem;
}

/* Tabs */
.auth-tabs {
  display: flex;
  background: var(--bg);
  border-radius: var(--radius);
  padding: 4px;
  margin-bottom: 24px;
}
.auth-tab {
  flex: 1;
  padding: 12px;
  border: none;
  background: transparent;
  border-radius: 12px;
  font-size: 0.9rem;
  font-weight: 600;
  color: var(--text-secondary);
  cursor: pointer;
  transition: var(--transition);
}
.auth-tab.active {
  background: white;
  color: var(--violet);
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.form-group {
  margin-bottom: 18px;
}
.form-group label {
  display: block;
  font-size: 0.85rem;
  font-weight: 600;
  margin-bottom: 8px;
  color: var(--text-secondary);
}
.form-input {
  width: 100%;
  padding: 14px 18px;
  background: var(--bg);
  border: 2px solid var(--border);
  border-radius: var(--radius);
  color: var(--text);
  font-size: 1rem;
  font-family: inherit;
  transition: var(--transition);
}
.form-input:focus {
  outline: none;
  border-color: var(--violet);
  background: white;
  box-shadow: 0 0 0 4px rgba(123,45,142,0.1);
}
.form-input::placeholder { color: var(--text-muted); }
.form-hint {
  font-size: 0.75rem;
  color: var(--text-muted);
  margin-top: 6px;
}

.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  width: 100%;
  padding: 16px 24px;
  border: none;
  border-radius: var(--radius);
  font-size: 1rem;
  font-weight: 700;
  font-family: inherit;
  cursor: pointer;
  transition: var(--transition);
  position: relative;
  overflow: hidden;
}
.btn::after {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(rgba(255,255,255,0.2), transparent);
  opacity: 0;
  transition: var(--transition);
}
.btn:hover::after { opacity: 1; }
.btn:hover { transform: translateY(-2px); }
.btn:active { transform: scale(0.98); }

.btn-primary { background: var(--grad-main); color: white; box-shadow: 0 8px 20px rgba(123,45,142,0.3); }
.btn-green { background: var(--grad-green); color: white; box-shadow: 0 8px 20px rgba(122,185,41,0.3); }
.btn-violet { background: var(--grad-violet); color: white; box-shadow: 0 8px 20px rgba(123,45,142,0.3); }
.btn-teal { background: var(--grad-teal); color: white; box-shadow: 0 8px 20px rgba(0,161,154,0.3); }
.btn-orange { background: linear-gradient(135deg, #F59E0B, #D97706); color: white; box-shadow: 0 8px 20px rgba(245,158,11,0.3); }
.btn-ghost { background: transparent; color: var(--text-secondary); box-shadow: none; }
.btn-ghost:hover { color: var(--text); background: var(--bg); }

.back-link {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  margin-top: 20px;
  color: var(--text-muted);
  font-size: 0.9rem;
  cursor: pointer;
  background: none;
  border: none;
  width: 100%;
  padding: 12px;
  transition: var(--transition);
}
.back-link:hover { color: var(--violet); }
.back-link svg { width: 18px; height: 18px; }

/* ==================== APP SHELL ==================== */
.app-shell {
  min-height: 100dvh;
  display: flex;
  flex-direction: column;
  padding-bottom: calc(80px + var(--safe-bottom));
}
.app-header {
  position: sticky;
  top: 0;
  z-index: 100;
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 16px;
  background: rgba(255,255,255,0.9);
  backdrop-filter: blur(20px);
  border-bottom: 1px solid var(--border);
}
.header-back {
  width: 42px;
  height: 42px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--bg);
  border: none;
  border-radius: var(--radius);
  cursor: pointer;
  transition: var(--transition);
}
.header-back:hover { background: var(--border); }
.header-back svg { width: 20px; height: 20px; stroke: var(--text); }
.header-logo { width: 36px; height: 36px; border-radius: 10px; }
.header-title { flex: 1; font-size: 1.1rem; font-weight: 700; }
.header-title.gradient { background: var(--grad-main); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
.header-xp {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 8px 14px;
  background: linear-gradient(135deg, rgba(245,158,11,0.15), rgba(245,158,11,0.05));
  border: 1px solid rgba(245,158,11,0.2);
  border-radius: var(--radius-full);
  font-weight: 800;
  font-size: 0.85rem;
  color: #D97706;
}
.header-xp svg { width: 16px; height: 16px; }

.app-main {
  flex: 1;
  padding: 20px 16px;
  max-width: 600px;
  margin: 0 auto;
  width: 100%;
}

/* ==================== GAMIFICATION ==================== */
.level-card {
  background: var(--grad-main);
  border-radius: var(--radius-lg);
  padding: 24px;
  margin-bottom: 20px;
  position: relative;
  overflow: hidden;
  color: white;
}
.level-card::before {
  content: '';
  position: absolute;
  top: -50%;
  right: -30%;
  width: 200px;
  height: 200px;
  background: rgba(255,255,255,0.1);
  border-radius: 50%;
}
.level-header {
  display: flex;
  align-items: center;
  gap: 16px;
  margin-bottom: 20px;
  position: relative;
  z-index: 1;
}
.level-avatar {
  width: 65px;
  height: 65px;
  background: rgba(255,255,255,0.2);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.8rem;
  border: 3px solid rgba(255,255,255,0.3);
}
.level-info h2 { font-size: 1.3rem; margin-bottom: 4px; }
.level-info p { opacity: 0.9; font-size: 0.85rem; }
.level-badge {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 5px 12px;
  background: rgba(255,255,255,0.2);
  border-radius: var(--radius-full);
  font-size: 0.75rem;
  font-weight: 700;
  margin-top: 6px;
}
.xp-progress { position: relative; z-index: 1; }
.xp-bar-bg {
  height: 10px;
  background: rgba(0,0,0,0.2);
  border-radius: var(--radius-full);
  overflow: hidden;
  margin-bottom: 8px;
}
.xp-bar-fill {
  height: 100%;
  background: linear-gradient(90deg, #FCD34D, #F59E0B);
  border-radius: var(--radius-full);
  transition: width 1s ease;
  position: relative;
}
.xp-bar-fill::after {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
  animation: shimmer 2s infinite;
}
@keyframes shimmer { from { transform: translateX(-100%); } to { transform: translateX(100%); } }
.xp-text { display: flex; justify-content: space-between; font-size: 0.8rem; font-weight: 600; opacity: 0.9; }

/* Streak */
.streak-card {
  background: white;
  border: 2px solid rgba(239,68,68,0.2);
  border-radius: var(--radius);
  padding: 18px;
  display: flex;
  align-items: center;
  gap: 14px;
  margin-bottom: 20px;
  box-shadow: var(--shadow);
}
.streak-flame { font-size: 2.2rem; animation: flamePulse 1s infinite alternate; }
@keyframes flamePulse { from { transform: scale(1); } to { transform: scale(1.1); } }
.streak-info h3 { font-size: 1rem; color: var(--text); margin-bottom: 2px; }
.streak-info p { font-size: 0.8rem; color: var(--text-secondary); }
.streak-days { display: flex; gap: 5px; margin-top: 8px; }
.streak-day {
  width: 28px; height: 28px;
  border-radius: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.7rem;
  font-weight: 700;
  background: var(--bg);
  color: var(--text-muted);
}
.streak-day.done { background: linear-gradient(135deg, #EF4444, #DC2626); color: white; }
.streak-day.today { border: 2px solid #EF4444; color: #EF4444; background: rgba(239,68,68,0.1); }

/* Stats */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 10px;
  margin-bottom: 24px;
}
.stat-card {
  background: white;
  border-radius: var(--radius);
  padding: 14px 10px;
  text-align: center;
  box-shadow: var(--shadow);
  transition: var(--transition);
}
.stat-card:hover { transform: translateY(-4px); }
.stat-icon {
  width: 32px; height: 32px;
  margin: 0 auto 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: linear-gradient(135deg, var(--stat-color), transparent);
  border-radius: 8px;
}
.stat-icon svg { width: 18px; height: 18px; stroke: var(--stat-color); }
.stat-value { font-size: 1.25rem; font-weight: 800; font-family: 'Nunito', sans-serif; color: var(--stat-color); }
.stat-label { font-size: 0.65rem; color: var(--text-muted); margin-top: 2px; text-transform: uppercase; letter-spacing: 0.5px; }
.stat-card.xp { --stat-color: #F59E0B; }
.stat-card.recipes { --stat-color: var(--green); }
.stat-card.badges { --stat-color: var(--violet); }
.stat-card.streak { --stat-color: #EF4444; }

/* Section */
.section { margin-bottom: 24px; }
.section-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 14px; }
.section-title { font-size: 1.1rem; display: flex; align-items: center; gap: 8px; color: var(--text); }
.section-title svg { width: 20px; height: 20px; stroke: var(--violet); }
.section-link { font-size: 0.85rem; color: var(--violet); font-weight: 600; cursor: pointer; background: none; border: none; }

/* Recipe Cards */
.recipe-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
.recipe-card {
  background: white;
  border-radius: var(--radius);
  overflow: hidden;
  cursor: pointer;
  box-shadow: var(--shadow);
  transition: var(--transition);
}
.recipe-card:hover { transform: translateY(-6px); box-shadow: var(--shadow-lg); }
.recipe-img {
  height: 110px;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
}
.recipe-emoji { font-size: 3rem; transition: var(--transition); filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2)); }
.recipe-card:hover .recipe-emoji { transform: scale(1.15) rotate(5deg); }
.recipe-badge {
  position: absolute;
  top: 8px; right: 8px;
  padding: 4px 10px;
  border-radius: var(--radius-full);
  font-size: 0.65rem;
  font-weight: 700;
  color: white;
}
.recipe-badge.easy { background: var(--green); }
.recipe-badge.medium { background: var(--accent); }
.recipe-badge.hard { background: var(--danger); }
.recipe-info { padding: 12px; }
.recipe-info h3 { font-size: 0.9rem; margin-bottom: 6px; line-height: 1.3; color: var(--text); }
.recipe-meta { display: flex; align-items: center; gap: 10px; font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 8px; }
.recipe-meta svg { width: 14px; height: 14px; }
.recipe-xp {
  display: inline-flex;
  align-items: center;
  gap: 5px;
  padding: 5px 10px;
  background: linear-gradient(135deg, rgba(245,158,11,0.15), rgba(245,158,11,0.05));
  border-radius: var(--radius-full);
  font-size: 0.75rem;
  font-weight: 700;
  color: #D97706;
}

/* Missions */
.mission-list { display: flex; flex-direction: column; gap: 10px; }
.mission-card {
  display: flex;
  align-items: center;
  gap: 12px;
  background: white;
  border-radius: var(--radius);
  padding: 14px;
  box-shadow: var(--shadow);
  cursor: pointer;
  transition: var(--transition);
}
.mission-card:hover { transform: translateX(4px); box-shadow: var(--shadow-lg); }
.mission-icon {
  width: 48px; height: 48px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: linear-gradient(135deg, var(--mission-color), transparent);
  border-radius: 12px;
  font-size: 1.3rem;
  flex-shrink: 0;
}
.mission-content { flex: 1; }
.mission-content h4 { font-size: 0.9rem; margin-bottom: 2px; color: var(--text); }
.mission-content p { font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 8px; }
.mission-progress { height: 5px; background: var(--bg); border-radius: var(--radius-full); overflow: hidden; }
.mission-progress-fill { height: 100%; background: var(--mission-color); border-radius: var(--radius-full); }
.mission-reward { text-align: center; min-width: 50px; }
.mission-reward .value { font-size: 1rem; font-weight: 800; color: var(--mission-color); }
.mission-reward .label { font-size: 0.6rem; color: var(--text-muted); text-transform: uppercase; }
.mission-card.photo { --mission-color: #EC4899; }
.mission-card.cook { --mission-color: var(--green); }
.mission-card.challenge { --mission-color: #F59E0B; }

/* Messages */
.message-list { display: flex; flex-direction: column; gap: 10px; }
.message-card {
  display: flex;
  gap: 12px;
  background: white;
  border-radius: var(--radius);
  padding: 14px;
  box-shadow: var(--shadow);
  cursor: pointer;
  transition: var(--transition);
}
.message-card:hover { box-shadow: var(--shadow-lg); }
.message-card.unread { border-left: 4px solid var(--violet); background: linear-gradient(90deg, rgba(123,45,142,0.05), transparent); }
.message-avatar {
  width: 44px; height: 44px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.2rem;
  flex-shrink: 0;
}
.message-avatar.docente { background: linear-gradient(135deg, rgba(245,158,11,0.2), rgba(245,158,11,0.1)); }
.message-content { flex: 1; min-width: 0; }
.message-content h4 { font-size: 0.9rem; color: var(--text); margin-bottom: 2px; }
.message-content p { font-size: 0.8rem; color: var(--text-secondary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.message-time { font-size: 0.7rem; color: var(--text-muted); white-space: nowrap; }

/* Chat */
.chat-container {
  display: flex;
  flex-direction: column;
  height: calc(100dvh - 180px);
  background: white;
  border-radius: var(--radius-lg);
  overflow: hidden;
  box-shadow: var(--shadow);
}
.chat-header {
  padding: 14px 16px;
  background: var(--grad-violet);
  display: flex;
  align-items: center;
  gap: 12px;
  color: white;
}
.chat-header img { width: 40px; height: 40px; border-radius: 50%; border: 2px solid rgba(255,255,255,0.3); }
.chat-header-info h3 { font-size: 0.95rem; }
.chat-header-info span { font-size: 0.75rem; opacity: 0.9; }
.chat-status { width: 10px; height: 10px; background: #22C55E; border-radius: 50%; margin-left: auto; box-shadow: 0 0 0 3px rgba(34,197,94,0.3); }
.chat-messages {
  flex: 1;
  padding: 16px;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  gap: 12px;
  background: var(--bg);
}
.msg { display: flex; gap: 10px; max-width: 85%; }
.msg.bot { align-self: flex-start; }
.msg.user { align-self: flex-end; flex-direction: row-reverse; }
.msg-avatar { width: 32px; height: 32px; border-radius: 50%; flex-shrink: 0; object-fit: cover; }
.msg.user .msg-avatar { background: var(--grad-teal); display: flex; align-items: center; justify-content: center; font-size: 0.9rem; }
.msg-bubble { padding: 12px 16px; border-radius: var(--radius); font-size: 0.9rem; line-height: 1.5; }
.msg.bot .msg-bubble { background: white; border: 1px solid var(--border); border-bottom-left-radius: 4px; }
.msg.user .msg-bubble { background: var(--grad-teal); color: white; border-bottom-right-radius: 4px; }
.chat-input {
  padding: 12px 16px;
  display: flex;
  gap: 10px;
  border-top: 1px solid var(--border);
  background: white;
}
.chat-input input { flex: 1; padding: 12px 16px; border: 1px solid var(--border); border-radius: var(--radius-full); font-size: 0.9rem; }
.chat-input input:focus { outline: none; border-color: var(--violet); }
.chat-input button {
  width: 44px; height: 44px;
  border-radius: 50%;
  background: var(--grad-violet);
  border: none;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
}
.chat-input button svg { width: 20px; height: 20px; stroke: white; }

/* Nav */
.app-nav {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  display: flex;
  justify-content: space-around;
  padding: 10px 8px;
  padding-bottom: calc(10px + var(--safe-bottom));
  background: rgba(255,255,255,0.95);
  backdrop-filter: blur(20px);
  border-top: 1px solid var(--border);
  z-index: 100;
}
.nav-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
  padding: 8px 14px;
  border-radius: var(--radius);
  background: none;
  border: none;
  color: var(--text-muted);
  font-size: 0.65rem;
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition);
}
.nav-item svg { width: 22px; height: 22px; stroke-width: 2; }
.nav-item.active { color: var(--violet); background: rgba(123,45,142,0.1); }
.nav-item:hover { color: var(--violet); }

/* Vicente FAB */
.vicente-fab {
  position: fixed;
  bottom: calc(90px + var(--safe-bottom));
  right: 16px;
  width: 60px;
  height: 60px;
  border-radius: 50%;
  background: white;
  border: 3px solid var(--violet);
  cursor: pointer;
  z-index: 90;
  box-shadow: var(--shadow-lg);
  transition: var(--transition);
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
}
.vicente-fab img { width: 50px; height: 50px; border-radius: 50%; object-fit: cover; }
.vicente-fab:hover { transform: scale(1.1); box-shadow: var(--shadow-lg), var(--glow-violet); }
.vicente-fab .notification {
  position: absolute;
  top: -2px; right: -2px;
  width: 16px; height: 16px;
  background: var(--danger);
  border-radius: 50%;
  border: 2px solid white;
}

/* Modal */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.5);
  backdrop-filter: blur(4px);
  z-index: 1000;
  display: flex;
  align-items: flex-end;
  justify-content: center;
  animation: fadeIn 0.3s ease;
}
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
.modal {
  background: white;
  border-radius: var(--radius-lg) var(--radius-lg) 0 0;
  width: 100%;
  max-width: 500px;
  max-height: 90vh;
  overflow-y: auto;
  animation: slideUpModal 0.4s var(--bounce);
}
@keyframes slideUpModal { from { transform: translateY(100%); } to { transform: translateY(0); } }
.modal-header {
  position: sticky;
  top: 0;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 18px 20px;
  background: white;
  border-bottom: 1px solid var(--border);
  z-index: 10;
}
.modal-header h2 { font-size: 1.15rem; color: var(--text); }
.modal-close {
  width: 38px; height: 38px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--bg);
  border: none;
  border-radius: var(--radius);
  cursor: pointer;
}
.modal-close:hover { background: var(--border); }
.modal-close svg { width: 18px; height: 18px; stroke: var(--text); }
.modal-body { padding: 20px; }
.modal-footer { padding: 16px 20px; border-top: 1px solid var(--border); background: var(--bg); }

/* Recipe Detail */
.recipe-hero {
  height: 180px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: var(--radius);
  margin-bottom: 20px;
}
.recipe-hero .recipe-emoji { font-size: 4.5rem; }
.recipe-detail-meta { display: flex; gap: 16px; margin-bottom: 20px; }
.recipe-detail-meta .meta-item { display: flex; align-items: center; gap: 6px; font-size: 0.85rem; color: var(--text-secondary); }
.recipe-detail-meta svg { width: 18px; height: 18px; stroke: var(--violet); }

.ingredient-list, .step-list { list-style: none; }
.ingredient-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 0;
  border-bottom: 1px solid var(--border);
  font-size: 0.9rem;
}
.ingredient-check {
  width: 24px; height: 24px;
  border: 2px solid var(--border);
  border-radius: 50%;
  cursor: pointer;
  transition: var(--transition);
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}
.ingredient-check:hover { border-color: var(--green); }
.ingredient-check.checked { background: var(--green); border-color: var(--green); }
.ingredient-check.checked::after { content: '‚úì'; color: white; font-size: 0.75rem; }
.step-item { display: flex; gap: 14px; margin-bottom: 16px; }
.step-number {
  width: 32px; height: 32px;
  background: var(--grad-violet);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 800;
  color: white;
  flex-shrink: 0;
  font-size: 0.85rem;
}
.step-text { flex: 1; padding-top: 4px; line-height: 1.5; font-size: 0.9rem; }

/* Toast */
.toast {
  position: fixed;
  bottom: 100px;
  left: 50%;
  transform: translateX(-50%) translateY(100px);
  background: white;
  padding: 14px 24px;
  border-radius: var(--radius);
  font-weight: 600;
  z-index: 2000;
  opacity: 0;
  transition: var(--transition);
  box-shadow: var(--shadow-lg);
}
.toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

/* Loading */
.loading { display: flex; align-items: center; justify-content: center; padding: 40px; }
.spinner { width: 36px; height: 36px; border: 3px solid var(--border); border-top-color: var(--violet); border-radius: 50%; animation: spin 1s linear infinite; }
@keyframes spin { to { transform: rotate(360deg); } }

/* Responsive */
@media (max-width: 400px) {
  .portal-grid { gap: 12px; }
  .avatar-card { padding: 20px 14px; }
  .avatar-illustration { width: 70px; height: 70px; }
  .hero-title h1 { font-size: 2.2rem; }
  .stats-grid { grid-template-columns: repeat(2, 1fr); }
  .recipe-grid { gap: 10px; }
}
  </style>
</head>
<body>
<div class="bg-gradient"></div>
<div class="bg-shapes">
  <div class="shape shape-1"></div>
  <div class="shape shape-2"></div>
  <div class="shape shape-3"></div>
</div>

<!-- SVG -->
<svg style="display:none">
  <defs>
    <symbol id="avatar-kids" viewBox="0 0 100 100">
      <defs><linearGradient id="kg" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#9AD649"/><stop offset="100%" style="stop-color:#7AB929"/></linearGradient></defs>
      <circle cx="50" cy="50" r="48" fill="url(#kg)"/>
      <ellipse cx="50" cy="22" rx="26" ry="14" fill="white"/><rect x="28" y="20" width="44" height="20" fill="white"/>
      <circle cx="35" cy="18" r="8" fill="white"/><circle cx="50" cy="14" r="10" fill="white"/><circle cx="65" cy="18" r="8" fill="white"/>
      <circle cx="50" cy="52" r="26" fill="#FFDBB4"/>
      <ellipse cx="42" cy="50" rx="5" ry="6" fill="#1a1a2e"/><ellipse cx="58" cy="50" rx="5" ry="6" fill="#1a1a2e"/>
      <circle cx="43" cy="48" r="2" fill="white"/><circle cx="59" cy="48" r="2" fill="white"/>
      <path d="M40 60 Q50 70 60 60" stroke="#1a1a2e" stroke-width="3" fill="none" stroke-linecap="round"/>
      <circle cx="34" cy="56" r="5" fill="#FFB4B4" opacity="0.6"/><circle cx="66" cy="56" r="5" fill="#FFB4B4" opacity="0.6"/>
    </symbol>
    <symbol id="avatar-teens" viewBox="0 0 100 100">
      <defs><linearGradient id="tg" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#9B4DB8"/><stop offset="100%" style="stop-color:#7B2D8E"/></linearGradient></defs>
      <circle cx="50" cy="50" r="48" fill="url(#tg)"/>
      <path d="M25 45 Q25 20 50 18 Q75 20 75 45 L70 45 Q70 28 50 26 Q30 28 30 45 Z" fill="#2D1B4E"/>
      <circle cx="50" cy="52" r="24" fill="#FFDBB4"/>
      <rect x="30" y="46" width="18" height="12" rx="4" fill="#1a1a2e"/><rect x="52" y="46" width="18" height="12" rx="4" fill="#1a1a2e"/>
      <rect x="48" y="50" width="4" height="3" fill="#1a1a2e"/>
      <rect x="32" y="48" width="6" height="2" rx="1" fill="white" opacity="0.3"/><rect x="54" y="48" width="6" height="2" rx="1" fill="white" opacity="0.3"/>
      <path d="M42 64 Q50 68 58 64" stroke="#1a1a2e" stroke-width="2.5" fill="none" stroke-linecap="round"/>
      <path d="M22 50 Q20 35 50 30 Q80 35 78 50" stroke="#00A19A" stroke-width="4" fill="none"/>
      <rect x="16" y="46" width="10" height="16" rx="4" fill="#00A19A"/><rect x="74" y="46" width="10" height="16" rx="4" fill="#00A19A"/>
    </symbol>
    <symbol id="avatar-parents" viewBox="0 0 100 100">
      <defs><linearGradient id="pg" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#00C4BC"/><stop offset="100%" style="stop-color:#00A19A"/></linearGradient></defs>
      <circle cx="50" cy="50" r="48" fill="url(#pg)"/>
      <circle cx="35" cy="40" r="16" fill="#FFDBB4"/><path d="M22 32 Q25 20 35 20 Q45 20 48 32" fill="#4A3728"/>
      <circle cx="31" cy="38" r="2" fill="#1a1a2e"/><circle cx="39" cy="38" r="2" fill="#1a1a2e"/>
      <path d="M31 44 Q35 47 39 44" stroke="#1a1a2e" stroke-width="1.5" fill="none"/>
      <circle cx="65" cy="40" r="16" fill="#FFDBB4"/><path d="M52 30 Q55 18 65 18 Q75 18 78 30 L75 32 Q72 24 65 24 Q58 24 55 32 Z" fill="#2D1B4E"/>
      <circle cx="61" cy="38" r="2" fill="#1a1a2e"/><circle cx="69" cy="38" r="2" fill="#1a1a2e"/>
      <path d="M61 44 Q65 47 69 44" stroke="#1a1a2e" stroke-width="1.5" fill="none"/>
      <circle cx="50" cy="68" r="14" fill="#FFDBB4"/><path d="M40 62 Q42 54 50 54 Q58 54 60 62" fill="#6B4423"/>
      <circle cx="46" cy="66" r="2" fill="#1a1a2e"/><circle cx="54" cy="66" r="2" fill="#1a1a2e"/>
      <path d="M46 72 Q50 76 54 72" stroke="#1a1a2e" stroke-width="1.5" fill="none"/>
      <path d="M50 82 C45 78 40 82 40 86 C40 90 50 95 50 95 C50 95 60 90 60 86 C60 82 55 78 50 82" fill="#EF4444"/>
    </symbol>
    <symbol id="avatar-docente" viewBox="0 0 100 100">
      <defs><linearGradient id="dg" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#FBBF24"/><stop offset="100%" style="stop-color:#F59E0B"/></linearGradient></defs>
      <circle cx="50" cy="50" r="48" fill="url(#dg)"/>
      <path d="M25 48 Q25 22 50 20 Q75 22 75 48 Q70 38 50 36 Q30 38 25 48" fill="#4A3728"/>
      <circle cx="50" cy="52" r="24" fill="#FFDBB4"/>
      <circle cx="40" cy="50" r="10" fill="none" stroke="#1a1a2e" stroke-width="2.5"/>
      <circle cx="60" cy="50" r="10" fill="none" stroke="#1a1a2e" stroke-width="2.5"/>
      <line x1="30" y1="48" x2="24" y2="46" stroke="#1a1a2e" stroke-width="2.5"/>
      <line x1="70" y1="48" x2="76" y2="46" stroke="#1a1a2e" stroke-width="2.5"/>
      <circle cx="40" cy="50" r="3" fill="#1a1a2e"/><circle cx="60" cy="50" r="3" fill="#1a1a2e"/>
      <circle cx="41" cy="49" r="1" fill="white"/><circle cx="61" cy="49" r="1" fill="white"/>
      <path d="M42 62 Q50 68 58 62" stroke="#1a1a2e" stroke-width="2.5" fill="none" stroke-linecap="round"/>
      <circle cx="80" cy="75" r="10" fill="#EF4444"/><path d="M80 66 L80 62" stroke="#4A3728" stroke-width="2"/><ellipse cx="83" cy="64" rx="4" ry="2" fill="#22C55E"/>
      <rect x="12" y="70" width="16" height="20" rx="2" fill="#7B2D8E"/><line x1="20" y1="70" x2="20" y2="90" stroke="white" stroke-width="1"/>
    </symbol>
    <symbol id="icon-home" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9,22 9,12 15,12 15,22"/></symbol>
    <symbol id="icon-book" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></symbol>
    <symbol id="icon-chat" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></symbol>
    <symbol id="icon-camera" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/></symbol>
    <symbol id="icon-trophy" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></symbol>
    <symbol id="icon-flame" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"/></symbol>
    <symbol id="icon-star" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26"/></symbol>
    <symbol id="icon-clock" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12,6 12,12 16,14"/></symbol>
    <symbol id="icon-back" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12,19 5,12 12,5"/></symbol>
    <symbol id="icon-x" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></symbol>
    <symbol id="icon-plus" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></symbol>
    <symbol id="icon-users" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></symbol>
    <symbol id="icon-zap" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13,2 3,14 12,14 11,22 21,10 12,10"/></symbol>
    <symbol id="icon-send" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22,2 15,22 11,13 2,9"/></symbol>
    <symbol id="icon-mail" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></symbol>
  </defs>
</svg>

<!-- ==================== PORTAL ==================== -->
<div id="portal" class="portal">
  <header class="portal-header">
    <div class="logo-badge"><img src="logo.png" alt="Rainero"><span>Culinaria</span></div>
    <div class="logo-badge"><img src="logo_mvl.png" alt="MVL"></div>
  </header>
  <main class="portal-content">
    <img src="logo.png" alt="Rainero Kids" class="hero-logo">
    <div class="hero-title"><h1>Rainero Kids</h1><p>Aprende a cocinar jugando üç≥</p></div>
    <div class="portal-grid">
      <div class="avatar-card kids" onclick="showLogin('kids')"><div class="avatar-illustration"><svg><use href="#avatar-kids"/></svg></div><h3>Ni√±os</h3><p>Mini chefs</p><span class="age-badge">‚≠ê 6-11 a√±os</span></div>
      <div class="avatar-card teens" onclick="showLogin('teens')"><div class="avatar-illustration"><svg><use href="#avatar-teens"/></svg></div><h3>Teens</h3><p>Level up!</p><span class="age-badge">üéÆ 12-17 a√±os</span></div>
      <div class="avatar-card parents" onclick="showLogin('parents')"><div class="avatar-illustration"><svg><use href="#avatar-parents"/></svg></div><h3>Familia</h3><p>Segu√≠ el progreso</p><span class="age-badge">üíô Portal</span></div>
      <div class="avatar-card docente" onclick="showLogin('docente')"><div class="avatar-illustration"><svg><use href="#avatar-docente"/></svg></div><h3>Profes</h3><p>Gesti√≥n</p><span class="age-badge">üìö Admin</span></div>
    </div>
  </main>
  <footer class="portal-footer"><p>Centro Municipal de Capacitaci√≥n Laboral Santiago Rainero</p></footer>
</div>

<!-- ==================== LOGINS ==================== -->
<div id="login-kids" class="login-screen hidden">
  <div class="login-card">
    <div class="login-header"><div class="login-avatar"><svg><use href="#avatar-kids"/></svg></div><h2 style="color:#7AB929">¬°Hola Chef! üëã</h2><p>Vicente te est√° esperando</p></div>
    <div class="form-group"><label>Tu nombre de chef</label><input type="text" class="form-input" id="kids-name-input" placeholder="Ej: MartinaCocina"></div>
    <div class="form-group"><label>Contrase√±a secreta</label><input type="password" class="form-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"></div>
    <button class="btn btn-green" onclick="login('kids')">üç≥ ¬°Entrar a cocinar!</button>
    <button class="back-link" onclick="showPortal()"><svg><use href="#icon-back"/></svg> Volver</button>
  </div>
</div>

<div id="login-teens" class="login-screen hidden">
  <div class="login-card">
    <div class="login-header"><div class="login-avatar"><svg><use href="#avatar-teens"/></svg></div><h2 style="color:#7B2D8E">Level Up Chef üéÆ</h2><p>Desbloquea nuevos desaf√≠os</p></div>
    <div class="form-group"><label>Usuario</label><input type="text" class="form-input" id="teens-name-input" placeholder="Tu nombre"></div>
    <div class="form-group"><label>Contrase√±a</label><input type="password" class="form-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"></div>
    <button class="btn btn-violet" onclick="login('teens')">‚ö° Ingresar</button>
    <button class="back-link" onclick="showPortal()"><svg><use href="#icon-back"/></svg> Volver</button>
  </div>
</div>

<div id="login-parents" class="login-screen hidden">
  <div class="login-card">
    <div class="login-header"><div class="login-avatar"><svg><use href="#avatar-parents"/></svg></div><h2 style="color:#00A19A">Portal Familiar üíô</h2><p>Segu√≠ el progreso de tus hijos</p></div>
    <div class="form-group"><label>Email</label><input type="email" class="form-input" id="parents-email" placeholder="tu@email.com"></div>
    <div class="form-group"><label>Contrase√±a</label><input type="password" class="form-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"></div>
    <button class="btn btn-teal" onclick="login('parents')">Ingresar</button>
    <button class="back-link" onclick="showPortal()"><svg><use href="#icon-back"/></svg> Volver</button>
  </div>
</div>

<div id="login-docente" class="login-screen hidden">
  <div class="login-card">
    <div class="login-header"><div class="login-avatar"><svg><use href="#avatar-docente"/></svg></div><h2 style="color:#F59E0B">Portal Docente üìö</h2><p>Gesti√≥n y administraci√≥n</p></div>
    <div class="auth-tabs">
      <button class="auth-tab active" onclick="showAuthTab('login')">Ingresar</button>
      <button class="auth-tab" onclick="showAuthTab('register')">Registrarse</button>
    </div>
    <div id="docente-login-form">
      <div class="form-group"><label>Email institucional</label><input type="email" class="form-input" id="docente-email" placeholder="profe@rainero.edu"></div>
      <div class="form-group"><label>Contrase√±a</label><input type="password" class="form-input" id="docente-pass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"></div>
      <button class="btn btn-orange" onclick="login('docente')">Ingresar al panel</button>
    </div>
    <div id="docente-register-form" class="hidden">
      <div class="form-group"><label>Nombre completo</label><input type="text" class="form-input" id="docente-name" placeholder="Mar√≠a Garc√≠a"></div>
      <div class="form-group"><label>Email institucional</label><input type="email" class="form-input" id="docente-email-reg" placeholder="profe@rainero.edu"><p class="form-hint">Debe ser un email @rainero.edu o @vicentelopez.gov.ar</p></div>
      <div class="form-group"><label>Contrase√±a</label><input type="password" class="form-input" id="docente-pass-reg" placeholder="M√≠nimo 8 caracteres"></div>
      <div class="form-group"><label>Confirmar contrase√±a</label><input type="password" class="form-input" id="docente-pass-confirm" placeholder="Repet√≠ tu contrase√±a"></div>
      <button class="btn btn-orange" onclick="registerDocente()">üìù Crear cuenta</button>
    </div>
    <button class="back-link" onclick="showPortal()"><svg><use href="#icon-back"/></svg> Volver</button>
  </div>
</div>

<!-- ==================== KIDS APP ==================== -->
<div id="app-kids" class="app-shell hidden">
  <header class="app-header">
    <button class="header-back" onclick="showPortal()"><svg><use href="#icon-back"/></svg></button>
    <img src="logo.png" alt="Logo" class="header-logo">
    <h1 class="header-title gradient">Rainero Kids</h1>
    <div class="header-xp"><svg><use href="#icon-zap"/></svg><span id="header-xp-value">1,250</span></div>
  </header>
  <main class="app-main">
    <div class="level-card">
      <div class="level-header">
        <div class="level-avatar">üë®‚Äçüç≥</div>
        <div class="level-info"><h2>¬°Hola, <span id="player-name">Chef</span>!</h2><p>Sous Chef en entrenamiento</p><span class="level-badge">‚≠ê Nivel 5</span></div>
      </div>
      <div class="xp-progress">
        <div class="xp-bar-bg"><div class="xp-bar-fill" style="width:65%"></div></div>
        <div class="xp-text"><span>1,250 / 2,000 XP</span><span>Nivel 6</span></div>
      </div>
    </div>
    <div class="streak-card">
      <div class="streak-flame">üî•</div>
      <div class="streak-info"><h3>¬°Racha de 5 d√≠as!</h3><p>Segu√≠ cocinando para mantenerla</p>
        <div class="streak-days"><span class="streak-day done">L</span><span class="streak-day done">M</span><span class="streak-day done">X</span><span class="streak-day done">J</span><span class="streak-day done">V</span><span class="streak-day today">S</span><span class="streak-day">D</span></div>
      </div>
    </div>
    <div class="stats-grid">
      <div class="stat-card xp"><div class="stat-icon"><svg><use href="#icon-zap"/></svg></div><div class="stat-value">1,250</div><div class="stat-label">XP</div></div>
      <div class="stat-card recipes"><div class="stat-icon"><svg><use href="#icon-book"/></svg></div><div class="stat-value" id="recipes-count">0</div><div class="stat-label">Recetas</div></div>
      <div class="stat-card badges"><div class="stat-icon"><svg><use href="#icon-trophy"/></svg></div><div class="stat-value">8</div><div class="stat-label">Logros</div></div>
      <div class="stat-card streak"><div class="stat-icon"><svg><use href="#icon-flame"/></svg></div><div class="stat-value">5</div><div class="stat-label">Racha</div></div>
    </div>
    <section class="section">
      <div class="section-header"><h2 class="section-title"><svg><use href="#icon-zap"/></svg>Misiones del d√≠a</h2></div>
      <div class="mission-list">
        <div class="mission-card photo"><div class="mission-icon">üì∏</div><div class="mission-content"><h4>Foto del plato</h4><p>Sub√≠ una foto de tu creaci√≥n</p><div class="mission-progress"><div class="mission-progress-fill" style="width:0%"></div></div></div><div class="mission-reward"><div class="value">+20</div><div class="label">XP</div></div></div>
        <div class="mission-card cook"><div class="mission-icon">üç≥</div><div class="mission-content"><h4>Chef Semanal</h4><p>Complet√° 3 recetas (2/3)</p><div class="mission-progress"><div class="mission-progress-fill" style="width:66%"></div></div></div><div class="mission-reward"><div class="value">+100</div><div class="label">XP</div></div></div>
        <div class="mission-card challenge"><div class="mission-icon">üèÜ</div><div class="mission-content"><h4>Desaf√≠o Verano</h4><p>Prepar√° una receta refrescante</p><div class="mission-progress"><div class="mission-progress-fill" style="width:0%"></div></div></div><div class="mission-reward"><div class="value">üèÖ</div><div class="label">Badge</div></div></div>
      </div>
    </section>
    <section class="section">
      <div class="section-header"><h2 class="section-title"><svg><use href="#icon-book"/></svg>Recetas para vos</h2><button class="section-link">Ver todas ‚Üí</button></div>
      <div class="recipe-grid" id="recipes-grid"><div class="loading"><div class="spinner"></div></div></div>
    </section>
  </main>
  <button class="vicente-fab" onclick="showToast('üí¨ Chat con Vicente pr√≥ximamente!')"><img src="vicente_celu.jpg" alt="Vicente"><span class="notification"></span></button>
  <nav class="app-nav">
    <button class="nav-item active"><svg><use href="#icon-home"/></svg>Inicio</button>
    <button class="nav-item"><svg><use href="#icon-book"/></svg>Recetas</button>
    <button class="nav-item"><svg><use href="#icon-chat"/></svg>Vicente</button>
    <button class="nav-item"><svg><use href="#icon-camera"/></svg>Galer√≠a</button>
    <button class="nav-item"><svg><use href="#icon-trophy"/></svg>Logros</button>
  </nav>
</div>

<!-- ==================== PARENTS APP ==================== -->
<div id="app-parents" class="app-shell hidden">
  <header class="app-header">
    <button class="header-back" onclick="showPortal()"><svg><use href="#icon-back"/></svg></button>
    <img src="logo.png" alt="Logo" class="header-logo">
    <h1 class="header-title">Portal Familiar</h1>
  </header>
  <main class="app-main">
    <div class="level-card" style="background:var(--grad-teal)">
      <div class="level-header">
        <div class="level-avatar">üë®‚Äçüë©‚Äçüëß</div>
        <div class="level-info"><h2>Familia Rodr√≠guez</h2><p>1 hijo/a inscripto</p></div>
      </div>
    </div>
    <section class="section">
      <div class="section-header"><h2 class="section-title"><svg><use href="#icon-users"/></svg>Progreso de Martina</h2></div>
      <div class="stats-grid">
        <div class="stat-card xp"><div class="stat-icon"><svg><use href="#icon-zap"/></svg></div><div class="stat-value">1,250</div><div class="stat-label">XP</div></div>
        <div class="stat-card recipes"><div class="stat-icon"><svg><use href="#icon-book"/></svg></div><div class="stat-value">12</div><div class="stat-label">Recetas</div></div>
        <div class="stat-card badges"><div class="stat-icon"><svg><use href="#icon-trophy"/></svg></div><div class="stat-value">8</div><div class="stat-label">Logros</div></div>
        <div class="stat-card"><div class="stat-icon"><svg><use href="#icon-star"/></svg></div><div class="stat-value">95%</div><div class="stat-label">Asistencia</div></div>
      </div>
    </section>
    <section class="section">
      <div class="section-header"><h2 class="section-title"><svg><use href="#icon-mail"/></svg>Mensajes del docente</h2></div>
      <div class="message-list">
        <div class="message-card unread"><div class="message-avatar docente">üë©‚Äçüè´</div><div class="message-content"><h4>Profe Mar√≠a</h4><p>¬°Martina hizo unos cupcakes incre√≠bles hoy! Adjunto foto...</p></div><div class="message-time">Hoy</div></div>
        <div class="message-card unread"><div class="message-avatar docente">üë©‚Äçüè´</div><div class="message-content"><h4>Profe Mar√≠a</h4><p>Recordatorio: ma√±ana traer delantal y gorro de chef</p></div><div class="message-time">Ayer</div></div>
        <div class="message-card"><div class="message-avatar docente">üë©‚Äçüè´</div><div class="message-content"><h4>Profe Mar√≠a</h4><p>Bienvenidos al programa de verano 2025! Les comparto...</p></div><div class="message-time">15 Dic</div></div>
      </div>
    </section>
  </main>
  <nav class="app-nav">
    <button class="nav-item active"><svg><use href="#icon-home"/></svg>Inicio</button>
    <button class="nav-item"><svg><use href="#icon-users"/></svg>Hijos</button>
    <button class="nav-item"><svg><use href="#icon-mail"/></svg>Mensajes</button>
    <button class="nav-item"><svg><use href="#icon-camera"/></svg>Galer√≠a</button>
    <button class="nav-item"><svg><use href="#icon-star"/></svg>Logros</button>
  </nav>
</div>

<!-- ==================== DOCENTE APP ==================== -->
<div id="app-docente" class="app-shell hidden">
  <header class="app-header">
    <button class="header-back" onclick="showPortal()"><svg><use href="#icon-back"/></svg></button>
    <img src="logo.png" alt="Logo" class="header-logo">
    <h1 class="header-title">Panel Docente</h1>
  </header>
  <main class="app-main">
    <div class="level-card" style="background:linear-gradient(135deg,#F59E0B,#D97706)">
      <div class="level-header">
        <div class="level-avatar">üë©‚Äçüè´</div>
        <div class="level-info"><h2>¬°Hola, Profe!</h2><p>Panel de gesti√≥n</p><span class="level-badge">üìö Verano 2025</span></div>
      </div>
    </div>
    <div class="stats-grid">
      <div class="stat-card" style="--stat-color:#7AB929"><div class="stat-icon"><svg><use href="#icon-users"/></svg></div><div class="stat-value">24</div><div class="stat-label">Kids</div></div>
      <div class="stat-card" style="--stat-color:#7B2D8E"><div class="stat-icon"><svg><use href="#icon-users"/></svg></div><div class="stat-value">18</div><div class="stat-label">Teens</div></div>
      <div class="stat-card" style="--stat-color:#00A19A"><div class="stat-icon"><svg><use href="#icon-book"/></svg></div><div class="stat-value" id="docente-recipes-count">0</div><div class="stat-label">Recetas</div></div>
      <div class="stat-card" style="--stat-color:#EC4899"><div class="stat-icon"><svg><use href="#icon-mail"/></svg></div><div class="stat-value">3</div><div class="stat-label">Mensajes</div></div>
    </div>
    <section class="section" id="docente-mensajes-section">
      <div class="section-header"><h2 class="section-title"><svg><use href="#icon-mail"/></svg>Enviar mensaje a padres</h2></div>
      <div style="background:white;border-radius:var(--radius);padding:16px;box-shadow:var(--shadow)">
        <div class="form-group" style="margin-bottom:12px"><label>Destinatarios</label><select class="form-input" id="msg-recipient"><option value="all">Todos los padres</option><option value="kids">Padres de Kids</option><option value="teens">Padres de Teens</option></select></div>
        <div class="form-group" style="margin-bottom:12px"><label>Asunto</label><input type="text" class="form-input" id="msg-subject" placeholder="Ej: Recordatorio clase de ma√±ana"></div>
        <div class="form-group" style="margin-bottom:12px"><label>Mensaje</label><textarea class="form-input" id="msg-content" rows="3" placeholder="Escrib√≠ tu mensaje..."></textarea></div>
        <button class="btn btn-violet" onclick="sendMessage()"><svg style="width:18px;height:18px"><use href="#icon-send"/></svg> Enviar mensaje</button>
      </div>
    </section>
    <section class="section">
      <div class="section-header"><h2 class="section-title"><svg><use href="#icon-book"/></svg>Gestionar Recetas</h2><button class="btn btn-primary" style="width:auto;padding:10px 16px;font-size:0.85rem" onclick="openRecipeForm()"><svg style="width:16px;height:16px"><use href="#icon-plus"/></svg>Nueva</button></div>
      <div class="recipe-grid" id="docente-recipes-grid"><div class="loading"><div class="spinner"></div></div></div>
    </section>
  </main>
  <nav class="app-nav">
    <button class="nav-item active"><svg><use href="#icon-home"/></svg>Inicio</button>
    <button class="nav-item"><svg><use href="#icon-users"/></svg>Alumnos</button>
    <button class="nav-item"><svg><use href="#icon-book"/></svg>Recetas</button>
    <button class="nav-item"><svg><use href="#icon-mail"/></svg>Mensajes</button>
    <button class="nav-item"><svg><use href="#icon-camera"/></svg>Galer√≠a</button>
  </nav>
</div>

<!-- TEENS -->
<div id="app-teens" class="app-shell hidden">
  <header class="app-header">
    <button class="header-back" onclick="showPortal()"><svg><use href="#icon-back"/></svg></button>
    <img src="logo.png" alt="Logo" class="header-logo">
    <h1 class="header-title gradient">Level Up Chef</h1>
    <div class="header-xp"><svg><use href="#icon-flame"/></svg><span>3,450 XP</span></div>
  </header>
  <main class="app-main">
    <div class="level-card" style="background:var(--grad-violet)">
      <div class="level-header">
        <div class="level-avatar">üéÆ</div>
        <div class="level-info"><h2>Hey, <span id="teens-player-name">Gamer</span>!</h2><p>Pro Chef en training</p><span class="level-badge">üî• Nivel 12</span></div>
      </div>
      <div class="xp-progress">
        <div class="xp-bar-bg"><div class="xp-bar-fill" style="width:75%"></div></div>
        <div class="xp-text"><span>3,450 / 4,500 XP</span><span>Nivel 13</span></div>
      </div>
    </div>
    <div class="stats-grid">
      <div class="stat-card xp"><div class="stat-icon"><svg><use href="#icon-zap"/></svg></div><div class="stat-value">3,450</div><div class="stat-label">XP</div></div>
      <div class="stat-card recipes"><div class="stat-icon"><svg><use href="#icon-book"/></svg></div><div class="stat-value">28</div><div class="stat-label">Recetas</div></div>
      <div class="stat-card badges"><div class="stat-icon"><svg><use href="#icon-trophy"/></svg></div><div class="stat-value">15</div><div class="stat-label">Logros</div></div>
      <div class="stat-card streak"><div class="stat-icon"><svg><use href="#icon-flame"/></svg></div><div class="stat-value">12</div><div class="stat-label">Racha</div></div>
    </div>
    <section class="section"><div class="section-header"><h2 class="section-title"><svg><use href="#icon-book"/></svg>Recetas</h2></div><div class="recipe-grid" id="teens-recipes-grid"></div></section>
  </main>
  <nav class="app-nav">
    <button class="nav-item active"><svg><use href="#icon-home"/></svg>Inicio</button>
    <button class="nav-item"><svg><use href="#icon-book"/></svg>Recetas</button>
    <button class="nav-item"><svg><use href="#icon-chat"/></svg>Vicente</button>
    <button class="nav-item"><svg><use href="#icon-camera"/></svg>Galer√≠a</button>
    <button class="nav-item"><svg><use href="#icon-trophy"/></svg>Ranking</button>
  </nav>
</div>

<!-- MODALS -->
<div id="recipe-modal" class="modal-overlay hidden" onclick="closeRecipeModal()">
  <div class="modal" onclick="event.stopPropagation()">
    <div class="modal-header"><h2 id="modal-title">Receta</h2><button class="modal-close" onclick="closeRecipeModal()"><svg><use href="#icon-x"/></svg></button></div>
    <div class="modal-body" id="modal-body"></div>
    <div class="modal-footer"><button class="btn btn-primary" onclick="completeRecipe()">üç≥ ¬°Preparar! <span style="opacity:0.8">+50 XP</span></button></div>
  </div>
</div>

<div id="form-modal" class="modal-overlay hidden" onclick="closeRecipeForm()">
  <div class="modal" onclick="event.stopPropagation()" style="max-height:95vh">
    <div class="modal-header"><h2>Nueva Receta</h2><button class="modal-close" onclick="closeRecipeForm()"><svg><use href="#icon-x"/></svg></button></div>
    <div class="modal-body">
      <div class="form-group"><label>Nombre *</label><input type="text" class="form-input" id="recipe-title" placeholder="Ej: Cupcakes de Vainilla"></div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
        <div class="form-group"><label>Tiempo (min)</label><input type="number" class="form-input" id="recipe-time" placeholder="30"></div>
        <div class="form-group"><label>Puntos</label><input type="number" class="form-input" id="recipe-points" placeholder="50"></div>
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
        <div class="form-group"><label>Dificultad</label><select class="form-input" id="recipe-difficulty"><option value="easy">F√°cil</option><option value="medium">Medio</option><option value="hard">Dif√≠cil</option></select></div>
        <div class="form-group"><label>Emoji</label><input type="text" class="form-input" id="recipe-emoji" placeholder="üßÅ" maxlength="4"></div>
      </div>
      <div class="form-group"><label>Ingredientes (uno por l√≠nea)</label><textarea class="form-input" id="recipe-ingredients" rows="4" placeholder="2 tazas de harina&#10;1 taza de az√∫car"></textarea></div>
      <div class="form-group"><label>Pasos (uno por l√≠nea)</label><textarea class="form-input" id="recipe-steps" rows="4" placeholder="Precalentar horno&#10;Mezclar ingredientes"></textarea></div>
    </div>
    <div class="modal-footer" style="display:flex;gap:12px">
      <button class="btn btn-ghost" onclick="closeRecipeForm()" style="flex:1">Cancelar</button>
      <button class="btn btn-primary" onclick="saveRecipe()" style="flex:2">üíæ Guardar</button>
    </div>
  </div>
</div>

<div id="toast" class="toast"></div>

<script>
const SUPABASE_URL = 'https://dukgjrhyhyxvdqzhthje.supabase.co';
const SUPABASE_KEY = 'sb_publishable_hdrC91CO7zGc3uoO2MsMVA_6K_CQmgd';

let db = null;
try { db = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY); console.log('‚úÖ Supabase conectado'); } catch(e) { console.log('‚ö†Ô∏è Sin Supabase'); }

let recipes = [];
const defaultRecipes = [
  {id:1, title:'Cupcakes de Vainilla', emoji:'üßÅ', time_minutes:30, difficulty:'easy', points:50, ingredients:['2 tazas harina','1 taza az√∫car','2 huevos','1/2 taza manteca'], steps:['Precalentar horno 180¬∞C','Mezclar secos','Agregar h√∫medos','Hornear 25 min']},
  {id:2, title:'Galletas con Chips', emoji:'üç™', time_minutes:25, difficulty:'easy', points:40, ingredients:['2 tazas harina','1 taza chips chocolate','1 huevo'], steps:['Mezclar manteca y az√∫car','Agregar huevo','Incorporar harina','Hornear 12 min']},
  {id:3, title:'Mini Pizzas', emoji:'üçï', time_minutes:45, difficulty:'medium', points:80, ingredients:['Masa','Salsa tomate','Mozzarella','Jam√≥n'], steps:['Estirar masa','Agregar salsa','Poner queso','Hornear 15 min']},
  {id:4, title:'Pancakes', emoji:'ü•û', time_minutes:20, difficulty:'easy', points:35, ingredients:['1 taza harina','1 huevo','1 taza leche'], steps:['Mezclar todo','Cocinar en sart√©n','Dar vuelta','Servir con miel']},
  {id:5, title:'Ensalada Arco√≠ris', emoji:'ü•ó', time_minutes:15, difficulty:'easy', points:30, ingredients:['Lechuga','Tomate','Zanahoria'], steps:['Lavar verduras','Cortar','Mezclar']},
  {id:6, title:'Tacos Caseros', emoji:'üåÆ', time_minutes:40, difficulty:'medium', points:70, ingredients:['Tortillas','Carne','Lechuga'], steps:['Cocinar carne','Calentar tortillas','Armar tacos']}
];

const gradients = [
  'linear-gradient(135deg, #7AB929, #5A8A1F)',
  'linear-gradient(135deg, #7B2D8E, #5A1F6A)',
  'linear-gradient(135deg, #00A19A, #007A75)',
  'linear-gradient(135deg, #F59E0B, #D97706)',
  'linear-gradient(135deg, #EC4899, #DB2777)',
  'linear-gradient(135deg, #3B82F6, #2563EB)'
];

function hideAll() { document.querySelectorAll('.portal, .login-screen, .app-shell, .modal-overlay').forEach(el => el.classList.add('hidden')); }
function showPortal() { hideAll(); document.getElementById('portal').classList.remove('hidden'); }
function showLogin(type) { hideAll(); document.getElementById('login-' + type).classList.remove('hidden'); }

function showAuthTab(tab) {
  document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
  event.target.classList.add('active');
  document.getElementById('docente-login-form').classList.toggle('hidden', tab !== 'login');
  document.getElementById('docente-register-form').classList.toggle('hidden', tab !== 'register');
}

async function registerDocente() {
  const name = document.getElementById('docente-name').value.trim();
  const email = document.getElementById('docente-email-reg').value.trim();
  const pass = document.getElementById('docente-pass-reg').value;
  const confirm = document.getElementById('docente-pass-confirm').value;
  
  if (!name || !email || !pass) { showToast('‚ùå Complet√° todos los campos'); return; }
  if (!email.includes('@rainero.edu') && !email.includes('@vicentelopez.gov.ar')) { showToast('‚ùå Us√° un email institucional'); return; }
  if (pass.length < 8) { showToast('‚ùå Contrase√±a muy corta (min 8)'); return; }
  if (pass !== confirm) { showToast('‚ùå Las contrase√±as no coinciden'); return; }
  
  showToast('‚úÖ ¬°Registro exitoso! Ya pod√©s ingresar');
  showAuthTab('login');
}

function login(type) {
  const nameInput = document.getElementById(type + '-name-input');
  const name = nameInput ? nameInput.value || 'Chef' : 'Chef';
  hideAll();
  document.getElementById('app-' + type).classList.remove('hidden');
  const playerNameEl = document.getElementById('player-name');
  if (playerNameEl) playerNameEl.textContent = name;
  const teensNameEl = document.getElementById('teens-player-name');
  if (teensNameEl && type === 'teens') teensNameEl.textContent = name;
  loadRecipes();
}

async function loadRecipes() {
  try {
    if (db) {
      const { data, error } = await db.from('recipes').select('*').order('id');
      if (!error && data && data.length > 0) { recipes = data; console.log('‚úÖ Recetas:', recipes.length); }
      else { recipes = defaultRecipes; }
    } else { recipes = defaultRecipes; }
  } catch(e) { recipes = defaultRecipes; }
  renderRecipes();
  updateCounts();
}

function renderRecipes() {
  const html = recipes.map((r, i) => `
    <div class="recipe-card" onclick="openRecipe(${r.id})">
      <div class="recipe-img" style="background:${gradients[i % gradients.length]}">
        <span class="recipe-emoji">${r.emoji || 'üçΩÔ∏è'}</span>
        <span class="recipe-badge ${r.difficulty}">${r.difficulty === 'easy' ? 'F√°cil' : r.difficulty === 'medium' ? 'Medio' : 'Dif√≠cil'}</span>
      </div>
      <div class="recipe-info">
        <h3>${r.title}</h3>
        <div class="recipe-meta"><svg><use href="#icon-clock"/></svg> ${r.time_minutes} min</div>
        <span class="recipe-xp"><svg style="width:14px;height:14px"><use href="#icon-zap"/></svg>+${r.points} XP</span>
      </div>
    </div>
  `).join('');
  ['recipes-grid', 'docente-recipes-grid', 'teens-recipes-grid'].forEach(id => { const el = document.getElementById(id); if (el) el.innerHTML = html; });
}

function updateCounts() {
  const count = recipes.length;
  ['recipes-count', 'docente-recipes-count'].forEach(id => { const el = document.getElementById(id); if (el) el.textContent = count; });
}

function openRecipe(id) {
  const r = recipes.find(x => x.id === id || x.id === parseInt(id));
  if (!r) return;
  const idx = recipes.indexOf(r);
  document.getElementById('modal-title').textContent = r.title;
  const ingredients = Array.isArray(r.ingredients) ? r.ingredients : (r.ingredients || '').split('\n').filter(Boolean);
  const steps = Array.isArray(r.steps) ? r.steps : (r.steps || '').split('\n').filter(Boolean);
  document.getElementById('modal-body').innerHTML = `
    <div class="recipe-hero" style="background:${gradients[idx % gradients.length]}"><span class="recipe-emoji">${r.emoji || 'üçΩÔ∏è'}</span></div>
    <div class="recipe-detail-meta">
      <div class="meta-item"><svg><use href="#icon-clock"/></svg> ${r.time_minutes} min</div>
      <div class="meta-item"><svg><use href="#icon-zap"/></svg> ${r.points} XP</div>
      <div class="meta-item"><svg><use href="#icon-star"/></svg> ${r.difficulty === 'easy' ? 'F√°cil' : r.difficulty === 'medium' ? 'Medio' : 'Dif√≠cil'}</div>
    </div>
    <h3 style="margin-bottom:12px;font-size:1rem">üìù Ingredientes</h3>
    <ul class="ingredient-list">${ingredients.map(i => `<li class="ingredient-item"><div class="ingredient-check" onclick="this.classList.toggle('checked')"></div>${i}</li>`).join('')}</ul>
    <h3 style="margin:20px 0 12px;font-size:1rem">üë®‚Äçüç≥ Preparaci√≥n</h3>
    <ul class="step-list">${steps.map((s, i) => `<li class="step-item"><div class="step-number">${i + 1}</div><div class="step-text">${s}</div></li>`).join('')}</ul>
  `;
  document.getElementById('recipe-modal').classList.remove('hidden');
}

function closeRecipeModal() { document.getElementById('recipe-modal').classList.add('hidden'); }
function completeRecipe() { showToast('üéâ ¬°Receta completada! +50 XP'); closeRecipeModal(); }

function openRecipeForm() { document.getElementById('form-modal').classList.remove('hidden'); }
function closeRecipeForm() { document.getElementById('form-modal').classList.add('hidden'); ['recipe-title', 'recipe-time', 'recipe-points', 'recipe-emoji', 'recipe-ingredients', 'recipe-steps'].forEach(id => { document.getElementById(id).value = ''; }); }

async function saveRecipe() {
  const title = document.getElementById('recipe-title').value.trim();
  const time = parseInt(document.getElementById('recipe-time').value) || 30;
  const points = parseInt(document.getElementById('recipe-points').value) || 50;
  const difficulty = document.getElementById('recipe-difficulty').value;
  const emoji = document.getElementById('recipe-emoji').value || 'üçΩÔ∏è';
  const ingredients = document.getElementById('recipe-ingredients').value.trim();
  const steps = document.getElementById('recipe-steps').value.trim();
  if (!title) { showToast('‚ùå Ingres√° un nombre'); return; }
  if (!ingredients) { showToast('‚ùå Agreg√° ingredientes'); return; }
  if (!steps) { showToast('‚ùå Agreg√° los pasos'); return; }
  const newRecipe = { title, time_minutes: time, points, difficulty, emoji, category: 'general' };
  try {
    if (db) { const { data, error } = await db.from('recipes').insert(newRecipe).select().single(); if (error) throw error; showToast('‚úÖ Receta guardada!'); }
    else { newRecipe.id = Date.now(); newRecipe.ingredients = ingredients.split('\n'); newRecipe.steps = steps.split('\n'); recipes.unshift(newRecipe); showToast('‚úÖ Guardada localmente'); }
    await loadRecipes();
    closeRecipeForm();
  } catch(e) { showToast('‚ùå Error al guardar'); }
}

function sendMessage() {
  const subject = document.getElementById('msg-subject').value.trim();
  const content = document.getElementById('msg-content').value.trim();
  if (!subject || !content) { showToast('‚ùå Complet√° el asunto y mensaje'); return; }
  showToast('‚úÖ Mensaje enviado a los padres!');
  document.getElementById('msg-subject').value = '';
  document.getElementById('msg-content').value = '';
}

function showToast(msg) { const toast = document.getElementById('toast'); toast.textContent = msg; toast.classList.add('show'); setTimeout(() => toast.classList.remove('show'), 3000); }

showPortal();
</script>
</body>
</html>
