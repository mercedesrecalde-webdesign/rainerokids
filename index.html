<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
  <title>Rainero Kids - Culinaria 4.0</title>
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#6366F1">
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="apple-touch-icon.png">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=Nunito:wght@700;800;900&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
:root {
  --primary: #6366F1;
  --primary-dark: #4F46E5;
  --secondary: #8B5CF6;
  --accent: #F59E0B;
  --success: #10B981;
  --danger: #EF4444;
  --cyan: #06B6D4;
  --pink: #EC4899;
  --bg: #0F0F1A;
  --bg-card: rgba(255,255,255,0.03);
  --bg-card-hover: rgba(255,255,255,0.06);
  --text: #FFFFFF;
  --text-secondary: rgba(255,255,255,0.6);
  --text-muted: rgba(255,255,255,0.4);
  --border: rgba(255,255,255,0.08);
  --glow: 0 0 40px rgba(99,102,241,0.3);
  --shadow: 0 25px 50px -12px rgba(0,0,0,0.5);
  --radius: 16px;
  --radius-lg: 24px;
  --radius-full: 9999px;
  --transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  --bounce: cubic-bezier(0.68, -0.55, 0.265, 1.55);
  --safe-bottom: env(safe-area-inset-bottom, 0px);
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: 'Inter', -apple-system, sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100dvh;
  overflow-x: hidden;
  -webkit-font-smoothing: antialiased;
}

/* Animated Background */
.bg-animation {
  position: fixed;
  inset: 0;
  z-index: -1;
  overflow: hidden;
}
.bg-animation::before {
  content: '';
  position: absolute;
  width: 150%;
  height: 150%;
  top: -25%;
  left: -25%;
  background: 
    radial-gradient(circle at 20% 80%, rgba(99,102,241,0.15) 0%, transparent 50%),
    radial-gradient(circle at 80% 20%, rgba(139,92,246,0.15) 0%, transparent 50%),
    radial-gradient(circle at 40% 40%, rgba(6,182,212,0.1) 0%, transparent 40%);
  animation: bgMove 20s ease-in-out infinite;
}
@keyframes bgMove {
  0%, 100% { transform: translate(0, 0) rotate(0deg); }
  33% { transform: translate(2%, 2%) rotate(1deg); }
  66% { transform: translate(-1%, 1%) rotate(-1deg); }
}

.hidden { display: none !important; }

/* Typography */
h1, h2, h3, h4 { font-family: 'Nunito', sans-serif; font-weight: 800; }

/* ==================== AVATAR CARDS ==================== */
.avatar-card {
  position: relative;
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  padding: 32px 24px;
  text-align: center;
  cursor: pointer;
  transition: var(--transition);
  overflow: hidden;
  backdrop-filter: blur(20px);
}
.avatar-card::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(135deg, var(--card-color) 0%, transparent 60%);
  opacity: 0;
  transition: var(--transition);
}
.avatar-card:hover {
  transform: translateY(-8px) scale(1.02);
  border-color: var(--card-color);
  box-shadow: 0 20px 40px rgba(0,0,0,0.3), 0 0 60px var(--card-glow);
}
.avatar-card:hover::before { opacity: 0.15; }
.avatar-card:active { transform: scale(0.98); }

.avatar-illustration {
  width: 100px;
  height: 100px;
  margin: 0 auto 20px;
  position: relative;
  z-index: 1;
}
.avatar-illustration svg {
  width: 100%;
  height: 100%;
  filter: drop-shadow(0 10px 20px var(--card-glow));
  transition: var(--transition);
}
.avatar-card:hover .avatar-illustration svg {
  transform: scale(1.1);
  filter: drop-shadow(0 15px 30px var(--card-glow));
}
.avatar-card h3 {
  font-size: 1.3rem;
  margin-bottom: 6px;
  position: relative;
  z-index: 1;
}
.avatar-card p {
  font-size: 0.85rem;
  color: var(--text-secondary);
  position: relative;
  z-index: 1;
}
.avatar-card .age-badge {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  margin-top: 12px;
  padding: 6px 14px;
  background: var(--card-color);
  border-radius: var(--radius-full);
  font-size: 0.75rem;
  font-weight: 700;
  position: relative;
  z-index: 1;
}

/* Card Colors */
.avatar-card.kids { --card-color: #10B981; --card-glow: rgba(16,185,129,0.4); }
.avatar-card.teens { --card-color: #8B5CF6; --card-glow: rgba(139,92,246,0.4); }
.avatar-card.parents { --card-color: #06B6D4; --card-glow: rgba(6,182,212,0.4); }
.avatar-card.docente { --card-color: #F59E0B; --card-glow: rgba(245,158,11,0.4); }

/* ==================== PORTAL ==================== */
.portal {
  min-height: 100dvh;
  display: flex;
  flex-direction: column;
  position: relative;
  padding: 20px;
}
.portal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 0;
}
.logo-badge {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px 16px;
  background: var(--bg-card);
  border-radius: var(--radius-full);
  border: 1px solid var(--border);
  backdrop-filter: blur(20px);
}
.logo-badge img { height: 24px; }
.portal-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 20px 0;
}
.hero-logo {
  width: 140px;
  height: 140px;
  border-radius: 50%;
  object-fit: cover;
  border: 4px solid var(--primary);
  box-shadow: var(--glow), 0 0 0 8px rgba(99,102,241,0.1);
  animation: float 4s ease-in-out infinite, pulse-glow 2s ease-in-out infinite alternate;
  margin-bottom: 28px;
}
@keyframes float {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-12px); }
}
@keyframes pulse-glow {
  from { box-shadow: var(--glow), 0 0 0 8px rgba(99,102,241,0.1); }
  to { box-shadow: 0 0 60px rgba(99,102,241,0.5), 0 0 0 12px rgba(99,102,241,0.15); }
}
.hero-title {
  text-align: center;
  margin-bottom: 40px;
}
.hero-title h1 {
  font-size: 2.8rem;
  background: linear-gradient(135deg, #fff 0%, var(--primary) 50%, var(--secondary) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  letter-spacing: -1px;
  margin-bottom: 8px;
}
.hero-title p {
  font-size: 1.1rem;
  color: var(--text-secondary);
  font-weight: 500;
}
.portal-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 16px;
  max-width: 440px;
  width: 100%;
}
.portal-footer {
  text-align: center;
  padding: 20px;
  color: var(--text-muted);
  font-size: 0.8rem;
}

/* ==================== LOGIN ==================== */
.login-screen {
  min-height: 100dvh;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 24px;
}
.login-card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  padding: 40px 32px;
  width: 100%;
  max-width: 400px;
  backdrop-filter: blur(20px);
  animation: slideUp 0.5s var(--bounce);
}
@keyframes slideUp {
  from { opacity: 0; transform: translateY(30px); }
  to { opacity: 1; transform: translateY(0); }
}
.login-header {
  text-align: center;
  margin-bottom: 32px;
}
.login-avatar {
  width: 90px;
  height: 90px;
  margin: 0 auto 20px;
}
.login-avatar svg { width: 100%; height: 100%; }
.login-header h2 {
  font-size: 1.6rem;
  margin-bottom: 8px;
}
.login-header p {
  color: var(--text-secondary);
}
.form-group {
  margin-bottom: 20px;
}
.form-group label {
  display: block;
  font-size: 0.85rem;
  font-weight: 600;
  margin-bottom: 10px;
  color: var(--text-secondary);
}
.form-input {
  width: 100%;
  padding: 16px 20px;
  background: rgba(255,255,255,0.05);
  border: 2px solid var(--border);
  border-radius: var(--radius);
  color: var(--text);
  font-size: 1rem;
  font-family: inherit;
  transition: var(--transition);
}
.form-input:focus {
  outline: none;
  border-color: var(--primary);
  background: rgba(99,102,241,0.1);
  box-shadow: 0 0 0 4px rgba(99,102,241,0.15);
}
.form-input::placeholder { color: var(--text-muted); }

.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  width: 100%;
  padding: 18px 28px;
  border: none;
  border-radius: var(--radius);
  font-size: 1rem;
  font-weight: 700;
  font-family: inherit;
  cursor: pointer;
  transition: var(--transition);
  position: relative;
  overflow: hidden;
}
.btn::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(rgba(255,255,255,0.2), transparent);
  opacity: 0;
  transition: var(--transition);
}
.btn:hover::before { opacity: 1; }
.btn:active { transform: scale(0.98); }

.btn-primary {
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  color: white;
  box-shadow: 0 10px 30px rgba(99,102,241,0.4);
}
.btn-primary:hover {
  box-shadow: 0 15px 40px rgba(99,102,241,0.5);
  transform: translateY(-2px);
}
.btn-kids { background: linear-gradient(135deg, #10B981, #059669); box-shadow: 0 10px 30px rgba(16,185,129,0.4); }
.btn-teens { background: linear-gradient(135deg, #8B5CF6, #7C3AED); box-shadow: 0 10px 30px rgba(139,92,246,0.4); }
.btn-parents { background: linear-gradient(135deg, #06B6D4, #0891B2); box-shadow: 0 10px 30px rgba(6,182,212,0.4); }
.btn-docente { background: linear-gradient(135deg, #F59E0B, #D97706); box-shadow: 0 10px 30px rgba(245,158,11,0.4); }

.btn-ghost {
  background: transparent;
  color: var(--text-secondary);
  box-shadow: none;
}
.btn-ghost:hover { color: var(--text); background: var(--bg-card); }

.back-link {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  margin-top: 24px;
  color: var(--text-muted);
  font-size: 0.9rem;
  cursor: pointer;
  transition: var(--transition);
  background: none;
  border: none;
  width: 100%;
  padding: 12px;
}
.back-link:hover { color: var(--text); }
.back-link svg { width: 18px; height: 18px; }

/* ==================== APP SHELL ==================== */
.app-shell {
  min-height: 100dvh;
  display: flex;
  flex-direction: column;
  padding-bottom: calc(80px + var(--safe-bottom));
}
.app-header {
  position: sticky;
  top: 0;
  z-index: 100;
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 16px;
  background: rgba(15,15,26,0.8);
  backdrop-filter: blur(20px);
  border-bottom: 1px solid var(--border);
}
.header-back {
  width: 44px;
  height: 44px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  cursor: pointer;
  transition: var(--transition);
}
.header-back:hover { background: var(--bg-card-hover); border-color: var(--primary); }
.header-back svg { width: 20px; height: 20px; stroke: var(--text); }
.header-logo { width: 36px; height: 36px; border-radius: 10px; }
.header-title { flex: 1; font-size: 1.1rem; font-weight: 700; }
.header-xp {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 16px;
  background: linear-gradient(135deg, rgba(245,158,11,0.2), rgba(245,158,11,0.1));
  border: 1px solid rgba(245,158,11,0.3);
  border-radius: var(--radius-full);
  font-weight: 800;
  font-size: 0.9rem;
  color: #F59E0B;
}
.header-avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  border: 2px solid var(--primary);
}

.app-main {
  flex: 1;
  padding: 20px 16px;
  max-width: 600px;
  margin: 0 auto;
  width: 100%;
}

/* ==================== GAMIFICATION ==================== */
/* Level Progress */
.level-card {
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  border-radius: var(--radius-lg);
  padding: 24px;
  margin-bottom: 20px;
  position: relative;
  overflow: hidden;
}
.level-card::before {
  content: '';
  position: absolute;
  top: -50%;
  right: -30%;
  width: 200px;
  height: 200px;
  background: rgba(255,255,255,0.1);
  border-radius: 50%;
}
.level-card::after {
  content: '';
  position: absolute;
  bottom: -30%;
  left: -20%;
  width: 150px;
  height: 150px;
  background: rgba(255,255,255,0.05);
  border-radius: 50%;
}
.level-header {
  display: flex;
  align-items: center;
  gap: 16px;
  margin-bottom: 20px;
  position: relative;
  z-index: 1;
}
.level-avatar {
  width: 70px;
  height: 70px;
  background: rgba(255,255,255,0.2);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2rem;
  border: 3px solid rgba(255,255,255,0.3);
}
.level-info h2 { font-size: 1.4rem; margin-bottom: 4px; }
.level-info p { opacity: 0.9; font-size: 0.9rem; }
.level-badge {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 6px 12px;
  background: rgba(255,255,255,0.2);
  border-radius: var(--radius-full);
  font-size: 0.8rem;
  font-weight: 700;
  margin-top: 8px;
}
.xp-progress {
  position: relative;
  z-index: 1;
}
.xp-bar-bg {
  height: 12px;
  background: rgba(0,0,0,0.3);
  border-radius: var(--radius-full);
  overflow: hidden;
  margin-bottom: 8px;
}
.xp-bar-fill {
  height: 100%;
  background: linear-gradient(90deg, #FCD34D, #F59E0B);
  border-radius: var(--radius-full);
  transition: width 1s ease;
  position: relative;
}
.xp-bar-fill::after {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
  animation: shimmer 2s infinite;
}
@keyframes shimmer {
  from { transform: translateX(-100%); }
  to { transform: translateX(100%); }
}
.xp-text {
  display: flex;
  justify-content: space-between;
  font-size: 0.85rem;
  font-weight: 600;
  opacity: 0.9;
}

/* Stats Grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 12px;
  margin-bottom: 24px;
}
.stat-card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 16px 12px;
  text-align: center;
  transition: var(--transition);
}
.stat-card:hover {
  background: var(--bg-card-hover);
  transform: translateY(-4px);
  border-color: var(--stat-color, var(--primary));
}
.stat-icon {
  width: 36px;
  height: 36px;
  margin: 0 auto 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: linear-gradient(135deg, var(--stat-color, var(--primary)), transparent);
  border-radius: 10px;
}
.stat-icon svg { width: 20px; height: 20px; stroke: var(--stat-color, var(--primary)); }
.stat-value {
  font-size: 1.4rem;
  font-weight: 800;
  font-family: 'Nunito', sans-serif;
  color: var(--stat-color, var(--text));
}
.stat-label {
  font-size: 0.7rem;
  color: var(--text-muted);
  margin-top: 4px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}
.stat-card.xp { --stat-color: #F59E0B; }
.stat-card.recipes { --stat-color: #10B981; }
.stat-card.badges { --stat-color: #8B5CF6; }
.stat-card.streak { --stat-color: #EF4444; }

/* Streak Fire Animation */
.streak-fire {
  position: relative;
}
.streak-fire::after {
  content: 'üî•';
  position: absolute;
  top: -8px;
  right: -8px;
  font-size: 1.2rem;
  animation: bounce 0.5s infinite alternate;
}
@keyframes bounce {
  from { transform: translateY(0) scale(1); }
  to { transform: translateY(-4px) scale(1.1); }
}

/* Section */
.section {
  margin-bottom: 28px;
}
.section-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 16px;
}
.section-title {
  font-size: 1.15rem;
  display: flex;
  align-items: center;
  gap: 10px;
}
.section-title svg { width: 22px; height: 22px; stroke: var(--primary); }
.section-link {
  font-size: 0.85rem;
  color: var(--primary);
  font-weight: 600;
  cursor: pointer;
  background: none;
  border: none;
  transition: var(--transition);
}
.section-link:hover { color: var(--secondary); }

/* Recipe Cards */
.recipe-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 14px;
}
.recipe-card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  overflow: hidden;
  cursor: pointer;
  transition: var(--transition);
}
.recipe-card:hover {
  transform: translateY(-6px) scale(1.02);
  border-color: var(--primary);
  box-shadow: 0 20px 40px rgba(0,0,0,0.3);
}
.recipe-img {
  height: 120px;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  background: linear-gradient(135deg, var(--recipe-color, var(--primary)) 0%, transparent 100%);
}
.recipe-emoji {
  font-size: 3.5rem;
  filter: drop-shadow(0 8px 16px rgba(0,0,0,0.3));
  transition: var(--transition);
}
.recipe-card:hover .recipe-emoji { transform: scale(1.15) rotate(5deg); }
.recipe-badge {
  position: absolute;
  top: 10px;
  right: 10px;
  padding: 4px 10px;
  border-radius: var(--radius-full);
  font-size: 0.65rem;
  font-weight: 700;
  text-transform: uppercase;
}
.recipe-badge.easy { background: var(--success); }
.recipe-badge.medium { background: var(--accent); }
.recipe-badge.hard { background: var(--danger); }
.recipe-info { padding: 14px; }
.recipe-info h3 {
  font-size: 0.95rem;
  margin-bottom: 8px;
  line-height: 1.3;
}
.recipe-meta {
  display: flex;
  align-items: center;
  gap: 12px;
  font-size: 0.75rem;
  color: var(--text-secondary);
  margin-bottom: 10px;
}
.recipe-meta svg { width: 14px; height: 14px; }
.recipe-xp {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 6px 12px;
  background: linear-gradient(135deg, rgba(245,158,11,0.2), rgba(245,158,11,0.1));
  border-radius: var(--radius-full);
  font-size: 0.8rem;
  font-weight: 700;
  color: #F59E0B;
}

/* Missions */
.mission-list { display: flex; flex-direction: column; gap: 12px; }
.mission-card {
  display: flex;
  align-items: center;
  gap: 14px;
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 16px;
  cursor: pointer;
  transition: var(--transition);
}
.mission-card:hover {
  background: var(--bg-card-hover);
  border-color: var(--mission-color);
  transform: translateX(4px);
}
.mission-icon {
  width: 52px;
  height: 52px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: linear-gradient(135deg, var(--mission-color), transparent);
  border-radius: 14px;
  font-size: 1.5rem;
  flex-shrink: 0;
}
.mission-content { flex: 1; }
.mission-content h4 { font-size: 0.95rem; margin-bottom: 4px; }
.mission-content p { font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 10px; }
.mission-progress {
  height: 6px;
  background: rgba(255,255,255,0.1);
  border-radius: var(--radius-full);
  overflow: hidden;
}
.mission-progress-fill {
  height: 100%;
  background: var(--mission-color);
  border-radius: var(--radius-full);
  transition: width 0.5s ease;
}
.mission-reward {
  text-align: center;
  min-width: 55px;
}
.mission-reward .value {
  font-size: 1.1rem;
  font-weight: 800;
  color: var(--mission-color);
}
.mission-reward .label {
  font-size: 0.65rem;
  color: var(--text-muted);
  text-transform: uppercase;
}
.mission-card.photo { --mission-color: #EC4899; }
.mission-card.cook { --mission-color: #10B981; }
.mission-card.challenge { --mission-color: #F59E0B; }

/* Daily Streak */
.streak-card {
  background: linear-gradient(135deg, rgba(239,68,68,0.15), rgba(239,68,68,0.05));
  border: 1px solid rgba(239,68,68,0.3);
  border-radius: var(--radius);
  padding: 20px;
  display: flex;
  align-items: center;
  gap: 16px;
  margin-bottom: 24px;
}
.streak-flame {
  width: 60px;
  height: 60px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2.5rem;
  animation: flamePulse 1s infinite alternate;
}
@keyframes flamePulse {
  from { transform: scale(1); filter: brightness(1); }
  to { transform: scale(1.1); filter: brightness(1.2); }
}
.streak-info h3 { font-size: 1.1rem; margin-bottom: 4px; }
.streak-info p { font-size: 0.85rem; color: var(--text-secondary); }
.streak-days {
  display: flex;
  gap: 6px;
  margin-top: 10px;
}
.streak-day {
  width: 32px;
  height: 32px;
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.8rem;
  font-weight: 700;
  background: rgba(255,255,255,0.1);
  color: var(--text-muted);
}
.streak-day.done {
  background: linear-gradient(135deg, #EF4444, #DC2626);
  color: white;
}
.streak-day.today {
  border: 2px solid #EF4444;
  color: #EF4444;
}

/* Achievement Unlock Animation */
.achievement-popup {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(0);
  background: var(--bg-card);
  border: 2px solid var(--accent);
  border-radius: var(--radius-lg);
  padding: 40px;
  text-align: center;
  z-index: 2000;
  animation: achievementPop 0.6s var(--bounce) forwards;
  box-shadow: 0 0 100px rgba(245,158,11,0.5);
}
@keyframes achievementPop {
  0% { transform: translate(-50%, -50%) scale(0) rotate(-10deg); }
  100% { transform: translate(-50%, -50%) scale(1) rotate(0deg); }
}
.achievement-icon {
  font-size: 4rem;
  margin-bottom: 16px;
  animation: achievementBounce 0.5s ease 0.3s;
}
@keyframes achievementBounce {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.3); }
}
.achievement-popup h3 {
  font-size: 1.5rem;
  color: var(--accent);
  margin-bottom: 8px;
}
.achievement-popup p { color: var(--text-secondary); }

/* ==================== NAV ==================== */
.app-nav {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  display: flex;
  justify-content: space-around;
  padding: 12px 8px;
  padding-bottom: calc(12px + var(--safe-bottom));
  background: rgba(15,15,26,0.95);
  backdrop-filter: blur(20px);
  border-top: 1px solid var(--border);
  z-index: 100;
}
.nav-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
  padding: 10px 16px;
  border-radius: var(--radius);
  background: none;
  border: none;
  color: var(--text-muted);
  font-size: 0.65rem;
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition);
  position: relative;
}
.nav-item svg { width: 24px; height: 24px; stroke-width: 2; }
.nav-item.active {
  color: var(--primary);
  background: rgba(99,102,241,0.15);
}
.nav-item.active::before {
  content: '';
  position: absolute;
  top: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 20px;
  height: 3px;
  background: var(--primary);
  border-radius: 0 0 4px 4px;
}
.nav-item:hover { color: var(--text); }

/* Vicente Floating Button */
.vicente-fab {
  position: fixed;
  bottom: calc(90px + var(--safe-bottom));
  right: 20px;
  width: 64px;
  height: 64px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  border: none;
  cursor: pointer;
  z-index: 90;
  box-shadow: 0 10px 30px rgba(99,102,241,0.5);
  transition: var(--transition);
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
}
.vicente-fab img {
  width: 52px;
  height: 52px;
  border-radius: 50%;
  object-fit: cover;
}
.vicente-fab:hover {
  transform: scale(1.1);
  box-shadow: 0 15px 40px rgba(99,102,241,0.6);
}
.vicente-fab .notification {
  position: absolute;
  top: 0;
  right: 0;
  width: 18px;
  height: 18px;
  background: var(--danger);
  border-radius: 50%;
  border: 3px solid var(--bg);
  animation: pulse 2s infinite;
}
@keyframes pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.2); }
}

/* ==================== MODALS ==================== */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.8);
  backdrop-filter: blur(8px);
  z-index: 1000;
  display: flex;
  align-items: flex-end;
  justify-content: center;
  animation: fadeIn 0.3s ease;
}
@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}
.modal {
  background: #1a1a2e;
  border: 1px solid var(--border);
  border-radius: var(--radius-lg) var(--radius-lg) 0 0;
  width: 100%;
  max-width: 500px;
  max-height: 90vh;
  overflow-y: auto;
  animation: slideUpModal 0.4s var(--bounce);
}
@keyframes slideUpModal {
  from { transform: translateY(100%); }
  to { transform: translateY(0); }
}
.modal-header {
  position: sticky;
  top: 0;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 20px 24px;
  background: #1a1a2e;
  border-bottom: 1px solid var(--border);
  z-index: 10;
}
.modal-header h2 { font-size: 1.2rem; }
.modal-close {
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  cursor: pointer;
  transition: var(--transition);
}
.modal-close:hover { background: var(--bg-card-hover); border-color: var(--danger); }
.modal-close svg { width: 20px; height: 20px; stroke: var(--text); }
.modal-body { padding: 24px; }
.modal-footer {
  padding: 20px 24px;
  border-top: 1px solid var(--border);
  background: rgba(0,0,0,0.2);
}

/* Recipe Detail */
.recipe-hero {
  height: 200px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: var(--radius);
  margin-bottom: 24px;
  position: relative;
  overflow: hidden;
}
.recipe-hero::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(180deg, transparent 50%, rgba(0,0,0,0.6));
}
.recipe-hero .recipe-emoji { font-size: 5rem; position: relative; z-index: 1; }
.recipe-detail-meta {
  display: flex;
  gap: 20px;
  margin-bottom: 24px;
}
.recipe-detail-meta .meta-item {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 0.9rem;
  color: var(--text-secondary);
}
.recipe-detail-meta svg { width: 20px; height: 20px; stroke: var(--primary); }

.ingredient-list, .step-list { list-style: none; }
.ingredient-item {
  display: flex;
  align-items: center;
  gap: 14px;
  padding: 14px 0;
  border-bottom: 1px solid var(--border);
  font-size: 0.95rem;
}
.ingredient-check {
  width: 26px;
  height: 26px;
  border: 2px solid var(--border);
  border-radius: 50%;
  cursor: pointer;
  transition: var(--transition);
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}
.ingredient-check:hover { border-color: var(--success); }
.ingredient-check.checked {
  background: var(--success);
  border-color: var(--success);
}
.ingredient-check.checked::after { content: '‚úì'; color: white; font-size: 0.8rem; }
.step-item {
  display: flex;
  gap: 16px;
  margin-bottom: 20px;
}
.step-number {
  width: 36px;
  height: 36px;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 800;
  flex-shrink: 0;
}
.step-text {
  flex: 1;
  padding-top: 6px;
  line-height: 1.6;
}

/* Toast */
.toast {
  position: fixed;
  bottom: 100px;
  left: 50%;
  transform: translateX(-50%) translateY(100px);
  background: var(--bg-card);
  border: 1px solid var(--border);
  padding: 16px 24px;
  border-radius: var(--radius);
  font-weight: 600;
  z-index: 2000;
  opacity: 0;
  transition: var(--transition);
  backdrop-filter: blur(20px);
}
.toast.show {
  opacity: 1;
  transform: translateX(-50%) translateY(0);
}

/* Loading */
.loading {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 40px;
}
.spinner {
  width: 40px;
  height: 40px;
  border: 3px solid var(--border);
  border-top-color: var(--primary);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }

/* Responsive */
@media (max-width: 400px) {
  .portal-grid { gap: 12px; }
  .avatar-card { padding: 24px 16px; }
  .avatar-illustration { width: 80px; height: 80px; }
  .hero-title h1 { font-size: 2.2rem; }
  .stats-grid { grid-template-columns: repeat(2, 1fr); }
  .recipe-grid { gap: 10px; }
}
  </style>
</head>
<body>
<div class="bg-animation"></div>

<!-- SVG Illustrations -->
<svg style="display:none">
  <defs>
    <!-- Kids Avatar - Cute chef character -->
    <symbol id="avatar-kids" viewBox="0 0 100 100">
      <defs>
        <linearGradient id="kids-grad" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:#34D399"/>
          <stop offset="100%" style="stop-color:#10B981"/>
        </linearGradient>
      </defs>
      <circle cx="50" cy="50" r="48" fill="url(#kids-grad)"/>
      <!-- Chef hat -->
      <ellipse cx="50" cy="22" rx="26" ry="14" fill="white"/>
      <rect x="28" y="20" width="44" height="20" fill="white"/>
      <circle cx="35" cy="18" r="8" fill="white"/>
      <circle cx="50" cy="14" r="10" fill="white"/>
      <circle cx="65" cy="18" r="8" fill="white"/>
      <!-- Face -->
      <circle cx="50" cy="52" r="26" fill="#FFDBB4"/>
      <!-- Eyes -->
      <ellipse cx="42" cy="50" rx="5" ry="6" fill="#1a1a2e"/>
      <ellipse cx="58" cy="50" rx="5" ry="6" fill="#1a1a2e"/>
      <circle cx="43" cy="48" r="2" fill="white"/>
      <circle cx="59" cy="48" r="2" fill="white"/>
      <!-- Smile -->
      <path d="M40 60 Q50 70 60 60" stroke="#1a1a2e" stroke-width="3" fill="none" stroke-linecap="round"/>
      <!-- Cheeks -->
      <circle cx="34" cy="56" r="5" fill="#FFB4B4" opacity="0.6"/>
      <circle cx="66" cy="56" r="5" fill="#FFB4B4" opacity="0.6"/>
      <!-- Sparkles -->
      <path d="M15 35 L18 40 L15 45 L12 40 Z" fill="white" opacity="0.8"/>
      <path d="M85 30 L87 33 L85 36 L83 33 Z" fill="white" opacity="0.8"/>
    </symbol>
    
    <!-- Teens Avatar - Cool character with headphones -->
    <symbol id="avatar-teens" viewBox="0 0 100 100">
      <defs>
        <linearGradient id="teens-grad" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:#A78BFA"/>
          <stop offset="100%" style="stop-color:#8B5CF6"/>
        </linearGradient>
      </defs>
      <circle cx="50" cy="50" r="48" fill="url(#teens-grad)"/>
      <!-- Hair -->
      <path d="M25 45 Q25 20 50 18 Q75 20 75 45 L70 45 Q70 28 50 26 Q30 28 30 45 Z" fill="#2D1B4E"/>
      <!-- Face -->
      <circle cx="50" cy="52" r="24" fill="#FFDBB4"/>
      <!-- Cool sunglasses -->
      <rect x="30" y="46" width="18" height="12" rx="4" fill="#1a1a2e"/>
      <rect x="52" y="46" width="18" height="12" rx="4" fill="#1a1a2e"/>
      <rect x="48" y="50" width="4" height="3" fill="#1a1a2e"/>
      <line x1="30" y1="50" x2="24" y2="48" stroke="#1a1a2e" stroke-width="2"/>
      <line x1="70" y1="50" x2="76" y2="48" stroke="#1a1a2e" stroke-width="2"/>
      <!-- Reflection on glasses -->
      <rect x="32" y="48" width="6" height="2" rx="1" fill="white" opacity="0.3"/>
      <rect x="54" y="48" width="6" height="2" rx="1" fill="white" opacity="0.3"/>
      <!-- Smirk -->
      <path d="M42 64 Q50 68 58 64" stroke="#1a1a2e" stroke-width="2.5" fill="none" stroke-linecap="round"/>
      <!-- Headphones -->
      <path d="M22 50 Q20 35 50 30 Q80 35 78 50" stroke="#6366F1" stroke-width="4" fill="none"/>
      <rect x="16" y="46" width="10" height="16" rx="4" fill="#6366F1"/>
      <rect x="74" y="46" width="10" height="16" rx="4" fill="#6366F1"/>
      <!-- Lightning bolt -->
      <path d="M82 72 L78 78 L82 78 L79 85" stroke="#FCD34D" stroke-width="2" fill="none"/>
    </symbol>
    
    <!-- Parents Avatar - Family -->
    <symbol id="avatar-parents" viewBox="0 0 100 100">
      <defs>
        <linearGradient id="parents-grad" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:#22D3EE"/>
          <stop offset="100%" style="stop-color:#06B6D4"/>
        </linearGradient>
      </defs>
      <circle cx="50" cy="50" r="48" fill="url(#parents-grad)"/>
      <!-- Parent 1 (left) -->
      <circle cx="35" cy="40" r="16" fill="#FFDBB4"/>
      <path d="M22 32 Q25 20 35 20 Q45 20 48 32" fill="#4A3728"/>
      <circle cx="31" cy="38" r="2" fill="#1a1a2e"/>
      <circle cx="39" cy="38" r="2" fill="#1a1a2e"/>
      <path d="M31 44 Q35 47 39 44" stroke="#1a1a2e" stroke-width="1.5" fill="none"/>
      <!-- Parent 2 (right) -->
      <circle cx="65" cy="40" r="16" fill="#FFDBB4"/>
      <path d="M52 30 Q55 18 65 18 Q75 18 78 30 L75 32 Q72 24 65 24 Q58 24 55 32 Z" fill="#2D1B4E"/>
      <circle cx="61" cy="38" r="2" fill="#1a1a2e"/>
      <circle cx="69" cy="38" r="2" fill="#1a1a2e"/>
      <path d="M61 44 Q65 47 69 44" stroke="#1a1a2e" stroke-width="1.5" fill="none"/>
      <!-- Child (center bottom) -->
      <circle cx="50" cy="68" r="14" fill="#FFDBB4"/>
      <path d="M40 62 Q42 54 50 54 Q58 54 60 62" fill="#6B4423"/>
      <circle cx="46" cy="66" r="2" fill="#1a1a2e"/>
      <circle cx="54" cy="66" r="2" fill="#1a1a2e"/>
      <path d="M46 72 Q50 76 54 72" stroke="#1a1a2e" stroke-width="1.5" fill="none"/>
      <!-- Heart -->
      <path d="M50 82 C45 78 40 82 40 86 C40 90 50 95 50 95 C50 95 60 90 60 86 C60 82 55 78 50 82" fill="#EF4444"/>
    </symbol>
    
    <!-- Teacher Avatar - Professional with glasses -->
    <symbol id="avatar-docente" viewBox="0 0 100 100">
      <defs>
        <linearGradient id="docente-grad" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:#FBBF24"/>
          <stop offset="100%" style="stop-color:#F59E0B"/>
        </linearGradient>
      </defs>
      <circle cx="50" cy="50" r="48" fill="url(#docente-grad)"/>
      <!-- Hair -->
      <path d="M25 48 Q25 22 50 20 Q75 22 75 48 Q70 38 50 36 Q30 38 25 48" fill="#4A3728"/>
      <!-- Face -->
      <circle cx="50" cy="52" r="24" fill="#FFDBB4"/>
      <!-- Glasses -->
      <circle cx="40" cy="50" r="10" fill="none" stroke="#1a1a2e" stroke-width="2.5"/>
      <circle cx="60" cy="50" r="10" fill="none" stroke="#1a1a2e" stroke-width="2.5"/>
      <line x1="50" y1="50" x2="50" y2="50" stroke="#1a1a2e" stroke-width="2.5"/>
      <line x1="30" y1="48" x2="24" y2="46" stroke="#1a1a2e" stroke-width="2.5"/>
      <line x1="70" y1="48" x2="76" y2="46" stroke="#1a1a2e" stroke-width="2.5"/>
      <!-- Eyes behind glasses -->
      <circle cx="40" cy="50" r="3" fill="#1a1a2e"/>
      <circle cx="60" cy="50" r="3" fill="#1a1a2e"/>
      <circle cx="41" cy="49" r="1" fill="white"/>
      <circle cx="61" cy="49" r="1" fill="white"/>
      <!-- Smile -->
      <path d="M42 62 Q50 68 58 62" stroke="#1a1a2e" stroke-width="2.5" fill="none" stroke-linecap="round"/>
      <!-- Apple -->
      <circle cx="80" cy="75" r="10" fill="#EF4444"/>
      <path d="M80 66 L80 62" stroke="#4A3728" stroke-width="2"/>
      <ellipse cx="83" cy="64" rx="4" ry="2" fill="#22C55E"/>
      <!-- Book -->
      <rect x="12" y="70" width="16" height="20" rx="2" fill="#3B82F6"/>
      <line x1="20" y1="70" x2="20" y2="90" stroke="white" stroke-width="1"/>
      <rect x="14" y="74" width="5" height="1" fill="white" opacity="0.5"/>
      <rect x="14" y="77" width="4" height="1" fill="white" opacity="0.5"/>
    </symbol>
    
    <!-- Icons -->
    <symbol id="icon-home" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9,22 9,12 15,12 15,22"/>
    </symbol>
    <symbol id="icon-book" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
    </symbol>
    <symbol id="icon-chat" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
    </symbol>
    <symbol id="icon-camera" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/>
    </symbol>
    <symbol id="icon-trophy" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/>
    </symbol>
    <symbol id="icon-flame" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"/>
    </symbol>
    <symbol id="icon-star" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26"/>
    </symbol>
    <symbol id="icon-clock" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="10"/><polyline points="12,6 12,12 16,14"/>
    </symbol>
    <symbol id="icon-back" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <line x1="19" y1="12" x2="5" y2="12"/><polyline points="12,19 5,12 12,5"/>
    </symbol>
    <symbol id="icon-x" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
    </symbol>
    <symbol id="icon-plus" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
    </symbol>
    <symbol id="icon-users" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/>
    </symbol>
    <symbol id="icon-zap" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <polygon points="13,2 3,14 12,14 11,22 21,10 12,10"/>
    </symbol>
  </defs>
</svg>

<!-- ==================== PORTAL ==================== -->
<div id="portal" class="portal">
  <header class="portal-header">
    <div class="logo-badge">
      <img src="logo.png" alt="Rainero">
      <span style="font-weight:700;font-size:0.85rem;">Culinaria</span>
    </div>
    <div class="logo-badge">
      <img src="logo_mvl.png" alt="MVL">
    </div>
  </header>
  
  <main class="portal-content">
    <img src="logo.png" alt="Rainero Kids" class="hero-logo">
    <div class="hero-title">
      <h1>Rainero Kids</h1>
      <p>Aprende a cocinar jugando</p>
    </div>
    
    <div class="portal-grid">
      <div class="avatar-card kids" onclick="showLogin('kids')">
        <div class="avatar-illustration"><svg><use href="#avatar-kids"/></svg></div>
        <h3>Ni√±os</h3>
        <p>Mini chefs</p>
        <span class="age-badge">‚≠ê 6-11 a√±os</span>
      </div>
      
      <div class="avatar-card teens" onclick="showLogin('teens')">
        <div class="avatar-illustration"><svg><use href="#avatar-teens"/></svg></div>
        <h3>Teens</h3>
        <p>Level up!</p>
        <span class="age-badge">üéÆ 12-17 a√±os</span>
      </div>
      
      <div class="avatar-card parents" onclick="showLogin('parents')">
        <div class="avatar-illustration"><svg><use href="#avatar-parents"/></svg></div>
        <h3>Familia</h3>
        <p>Segu√≠ el progreso</p>
        <span class="age-badge">üíô Portal</span>
      </div>
      
      <div class="avatar-card docente" onclick="showLogin('docente')">
        <div class="avatar-illustration"><svg><use href="#avatar-docente"/></svg></div>
        <h3>Profes</h3>
        <p>Gesti√≥n</p>
        <span class="age-badge">üìö Admin</span>
      </div>
    </div>
  </main>
  
  <footer class="portal-footer">
    <p>Centro Municipal de Capacitaci√≥n Laboral Santiago Rainero</p>
  </footer>
</div>

<!-- ==================== LOGINS ==================== -->
<div id="login-kids" class="login-screen hidden">
  <div class="login-card">
    <div class="login-header">
      <div class="login-avatar"><svg><use href="#avatar-kids"/></svg></div>
      <h2 style="color:#10B981">¬°Hola Chef! üëã</h2>
      <p>Vicente te est√° esperando</p>
    </div>
    <div class="form-group">
      <label>Tu nombre de chef</label>
      <input type="text" class="form-input" id="kids-name-input" placeholder="Ej: MartinaCocina">
    </div>
    <div class="form-group">
      <label>Contrase√±a secreta</label>
      <input type="password" class="form-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
    </div>
    <button class="btn btn-kids" onclick="login('kids')">üç≥ ¬°Entrar a cocinar!</button>
    <button class="back-link" onclick="showPortal()">
      <svg><use href="#icon-back"/></svg> Volver al inicio
    </button>
  </div>
</div>

<div id="login-teens" class="login-screen hidden">
  <div class="login-card">
    <div class="login-header">
      <div class="login-avatar"><svg><use href="#avatar-teens"/></svg></div>
      <h2 style="color:#8B5CF6">Level Up Chef üéÆ</h2>
      <p>Desbloquea nuevos desaf√≠os</p>
    </div>
    <div class="form-group">
      <label>Usuario</label>
      <input type="text" class="form-input" id="teens-name-input" placeholder="Tu nombre">
    </div>
    <div class="form-group">
      <label>Contrase√±a</label>
      <input type="password" class="form-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
    </div>
    <button class="btn btn-teens" onclick="login('teens')">‚ö° Ingresar</button>
    <button class="back-link" onclick="showPortal()">
      <svg><use href="#icon-back"/></svg> Volver al inicio
    </button>
  </div>
</div>

<div id="login-parents" class="login-screen hidden">
  <div class="login-card">
    <div class="login-header">
      <div class="login-avatar"><svg><use href="#avatar-parents"/></svg></div>
      <h2 style="color:#06B6D4">Portal Familiar üíô</h2>
      <p>Segu√≠ el progreso de tus hijos</p>
    </div>
    <div class="form-group">
      <label>Email</label>
      <input type="email" class="form-input" placeholder="tu@email.com">
    </div>
    <div class="form-group">
      <label>Contrase√±a</label>
      <input type="password" class="form-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
    </div>
    <button class="btn btn-parents" onclick="login('parents')">Ingresar</button>
    <button class="back-link" onclick="showPortal()">
      <svg><use href="#icon-back"/></svg> Volver al inicio
    </button>
  </div>
</div>

<div id="login-docente" class="login-screen hidden">
  <div class="login-card">
    <div class="login-header">
      <div class="login-avatar"><svg><use href="#avatar-docente"/></svg></div>
      <h2 style="color:#F59E0B">Panel Docente üìö</h2>
      <p>Gesti√≥n y administraci√≥n</p>
    </div>
    <div class="form-group">
      <label>Email institucional</label>
      <input type="email" class="form-input" placeholder="profe@rainero.edu">
    </div>
    <div class="form-group">
      <label>Contrase√±a</label>
      <input type="password" class="form-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
    </div>
    <button class="btn btn-docente" onclick="login('docente')">Ingresar al panel</button>
    <button class="back-link" onclick="showPortal()">
      <svg><use href="#icon-back"/></svg> Volver al inicio
    </button>
  </div>
</div>

<!-- ==================== KIDS APP ==================== -->
<div id="app-kids" class="app-shell hidden">
  <header class="app-header">
    <button class="header-back" onclick="showPortal()">
      <svg><use href="#icon-back"/></svg>
    </button>
    <img src="logo.png" alt="Logo" class="header-logo">
    <h1 class="header-title">Rainero Kids</h1>
    <div class="header-xp">
      <svg style="width:18px;height:18px;stroke:#F59E0B"><use href="#icon-zap"/></svg>
      <span id="header-xp-value">1,250</span>
    </div>
  </header>
  
  <main class="app-main">
    <!-- Level Progress -->
    <div class="level-card">
      <div class="level-header">
        <div class="level-avatar">üë®‚Äçüç≥</div>
        <div class="level-info">
          <h2>¬°Hola, <span id="player-name">Chef</span>!</h2>
          <p>Sous Chef en entrenamiento</p>
          <span class="level-badge">‚≠ê Nivel 5</span>
        </div>
      </div>
      <div class="xp-progress">
        <div class="xp-bar-bg">
          <div class="xp-bar-fill" style="width: 65%"></div>
        </div>
        <div class="xp-text">
          <span>1,250 / 2,000 XP</span>
          <span>Nivel 6</span>
        </div>
      </div>
    </div>
    
    <!-- Daily Streak -->
    <div class="streak-card">
      <div class="streak-flame">üî•</div>
      <div class="streak-info">
        <h3>¬°Racha de 5 d√≠as!</h3>
        <p>Segu√≠ cocinando para mantenerla</p>
        <div class="streak-days">
          <span class="streak-day done">L</span>
          <span class="streak-day done">M</span>
          <span class="streak-day done">X</span>
          <span class="streak-day done">J</span>
          <span class="streak-day done">V</span>
          <span class="streak-day today">S</span>
          <span class="streak-day">D</span>
        </div>
      </div>
    </div>
    
    <!-- Stats -->
    <div class="stats-grid">
      <div class="stat-card xp">
        <div class="stat-icon"><svg><use href="#icon-zap"/></svg></div>
        <div class="stat-value">1,250</div>
        <div class="stat-label">XP Total</div>
      </div>
      <div class="stat-card recipes">
        <div class="stat-icon"><svg><use href="#icon-book"/></svg></div>
        <div class="stat-value" id="recipes-count">0</div>
        <div class="stat-label">Recetas</div>
      </div>
      <div class="stat-card badges">
        <div class="stat-icon"><svg><use href="#icon-trophy"/></svg></div>
        <div class="stat-value">8</div>
        <div class="stat-label">Logros</div>
      </div>
      <div class="stat-card streak streak-fire">
        <div class="stat-icon"><svg><use href="#icon-flame"/></svg></div>
        <div class="stat-value">5</div>
        <div class="stat-label">Racha</div>
      </div>
    </div>
    
    <!-- Missions -->
    <section class="section">
      <div class="section-header">
        <h2 class="section-title">
          <svg><use href="#icon-zap"/></svg>
          Misiones del d√≠a
        </h2>
      </div>
      <div class="mission-list">
        <div class="mission-card photo">
          <div class="mission-icon">üì∏</div>
          <div class="mission-content">
            <h4>Foto del plato</h4>
            <p>Sub√≠ una foto de tu creaci√≥n</p>
            <div class="mission-progress"><div class="mission-progress-fill" style="width:0%"></div></div>
          </div>
          <div class="mission-reward">
            <div class="value">+20</div>
            <div class="label">XP</div>
          </div>
        </div>
        <div class="mission-card cook">
          <div class="mission-icon">üç≥</div>
          <div class="mission-content">
            <h4>Chef Semanal</h4>
            <p>Complet√° 3 recetas (2/3)</p>
            <div class="mission-progress"><div class="mission-progress-fill" style="width:66%"></div></div>
          </div>
          <div class="mission-reward">
            <div class="value">+100</div>
            <div class="label">XP</div>
          </div>
        </div>
        <div class="mission-card challenge">
          <div class="mission-icon">üèÜ</div>
          <div class="mission-content">
            <h4>Desaf√≠o Verano</h4>
            <p>Prepar√° una receta refrescante</p>
            <div class="mission-progress"><div class="mission-progress-fill" style="width:0%"></div></div>
          </div>
          <div class="mission-reward">
            <div class="value">üèÖ</div>
            <div class="label">Badge</div>
          </div>
        </div>
      </div>
    </section>
    
    <!-- Recipes -->
    <section class="section">
      <div class="section-header">
        <h2 class="section-title">
          <svg><use href="#icon-book"/></svg>
          Recetas para vos
        </h2>
        <button class="section-link">Ver todas ‚Üí</button>
      </div>
      <div class="recipe-grid" id="recipes-grid">
        <div class="loading"><div class="spinner"></div></div>
      </div>
    </section>
  </main>
  
  <!-- Vicente FAB -->
  <button class="vicente-fab" onclick="showToast('üí¨ Chat con Vicente pr√≥ximamente!')">
    <img src="vicente_celu.jpg" alt="Vicente">
    <span class="notification"></span>
  </button>
  
  <!-- Bottom Nav -->
  <nav class="app-nav">
    <button class="nav-item active">
      <svg><use href="#icon-home"/></svg>
      Inicio
    </button>
    <button class="nav-item">
      <svg><use href="#icon-book"/></svg>
      Recetas
    </button>
    <button class="nav-item">
      <svg><use href="#icon-chat"/></svg>
      Vicente
    </button>
    <button class="nav-item">
      <svg><use href="#icon-camera"/></svg>
      Galer√≠a
    </button>
    <button class="nav-item">
      <svg><use href="#icon-trophy"/></svg>
      Logros
    </button>
  </nav>
</div>

<!-- ==================== DOCENTE APP ==================== -->
<div id="app-docente" class="app-shell hidden">
  <header class="app-header">
    <button class="header-back" onclick="showPortal()">
      <svg><use href="#icon-back"/></svg>
    </button>
    <img src="logo.png" alt="Logo" class="header-logo">
    <h1 class="header-title">Panel Docente</h1>
  </header>
  
  <main class="app-main">
    <div class="level-card" style="background: linear-gradient(135deg, #F59E0B, #D97706)">
      <div class="level-header">
        <div class="level-avatar">üë©‚Äçüè´</div>
        <div class="level-info">
          <h2>¬°Hola, Profe!</h2>
          <p>Panel de gesti√≥n</p>
          <span class="level-badge">üìö Verano 2025</span>
        </div>
      </div>
    </div>
    
    <div class="stats-grid">
      <div class="stat-card" style="--stat-color:#10B981">
        <div class="stat-icon"><svg><use href="#icon-users"/></svg></div>
        <div class="stat-value">24</div>
        <div class="stat-label">Kids</div>
      </div>
      <div class="stat-card" style="--stat-color:#8B5CF6">
        <div class="stat-icon"><svg><use href="#icon-users"/></svg></div>
        <div class="stat-value">18</div>
        <div class="stat-label">Teens</div>
      </div>
      <div class="stat-card" style="--stat-color:#06B6D4">
        <div class="stat-icon"><svg><use href="#icon-book"/></svg></div>
        <div class="stat-value" id="docente-recipes-count">0</div>
        <div class="stat-label">Recetas</div>
      </div>
      <div class="stat-card" style="--stat-color:#EC4899">
        <div class="stat-icon"><svg><use href="#icon-chat"/></svg></div>
        <div class="stat-value">8</div>
        <div class="stat-label">Mensajes</div>
      </div>
    </div>
    
    <section class="section">
      <div class="section-header">
        <h2 class="section-title">
          <svg><use href="#icon-book"/></svg>
          Gestionar Recetas
        </h2>
        <button class="btn btn-primary" style="width:auto;padding:10px 20px;font-size:0.85rem" onclick="openRecipeForm()">
          <svg style="width:16px;height:16px"><use href="#icon-plus"/></svg>
          Nueva
        </button>
      </div>
      <div class="recipe-grid" id="docente-recipes-grid">
        <div class="loading"><div class="spinner"></div></div>
      </div>
    </section>
  </main>
  
  <nav class="app-nav">
    <button class="nav-item active">
      <svg><use href="#icon-home"/></svg>
      Inicio
    </button>
    <button class="nav-item">
      <svg><use href="#icon-users"/></svg>
      Alumnos
    </button>
    <button class="nav-item">
      <svg><use href="#icon-book"/></svg>
      Recetas
    </button>
    <button class="nav-item">
      <svg><use href="#icon-chat"/></svg>
      Mensajes
    </button>
    <button class="nav-item">
      <svg><use href="#icon-camera"/></svg>
      Galer√≠a
    </button>
  </nav>
</div>

<!-- Teens and Parents apps follow same pattern -->
<div id="app-teens" class="app-shell hidden">
  <header class="app-header">
    <button class="header-back" onclick="showPortal()"><svg><use href="#icon-back"/></svg></button>
    <img src="logo.png" alt="Logo" class="header-logo">
    <h1 class="header-title" style="background:linear-gradient(90deg,#8B5CF6,#06B6D4);-webkit-background-clip:text;-webkit-text-fill-color:transparent">Level Up Chef</h1>
    <div class="header-xp"><svg style="width:18px;height:18px;stroke:#F59E0B"><use href="#icon-flame"/></svg><span>3,450 XP</span></div>
  </header>
  <main class="app-main">
    <div class="level-card" style="background:linear-gradient(135deg,#8B5CF6,#6366F1)">
      <div class="level-header">
        <div class="level-avatar">üéÆ</div>
        <div class="level-info"><h2>Hey, <span id="teens-player-name">Gamer</span>!</h2><p>Pro Chef en training</p><span class="level-badge">üî• Nivel 12</span></div>
      </div>
      <div class="xp-progress">
        <div class="xp-bar-bg"><div class="xp-bar-fill" style="width:75%"></div></div>
        <div class="xp-text"><span>3,450 / 4,500 XP</span><span>Nivel 13</span></div>
      </div>
    </div>
    <div class="stats-grid">
      <div class="stat-card xp"><div class="stat-icon"><svg><use href="#icon-zap"/></svg></div><div class="stat-value">3,450</div><div class="stat-label">XP</div></div>
      <div class="stat-card recipes"><div class="stat-icon"><svg><use href="#icon-book"/></svg></div><div class="stat-value">28</div><div class="stat-label">Recetas</div></div>
      <div class="stat-card badges"><div class="stat-icon"><svg><use href="#icon-trophy"/></svg></div><div class="stat-value">15</div><div class="stat-label">Logros</div></div>
      <div class="stat-card streak streak-fire"><div class="stat-icon"><svg><use href="#icon-flame"/></svg></div><div class="stat-value">12</div><div class="stat-label">Racha</div></div>
    </div>
    <section class="section"><div class="section-header"><h2 class="section-title"><svg><use href="#icon-book"/></svg>Recetas</h2></div><div class="recipe-grid" id="teens-recipes-grid"></div></section>
  </main>
  <nav class="app-nav">
    <button class="nav-item active"><svg><use href="#icon-home"/></svg>Inicio</button>
    <button class="nav-item"><svg><use href="#icon-book"/></svg>Recetas</button>
    <button class="nav-item"><svg><use href="#icon-chat"/></svg>Vicente</button>
    <button class="nav-item"><svg><use href="#icon-camera"/></svg>Galer√≠a</button>
    <button class="nav-item"><svg><use href="#icon-trophy"/></svg>Ranking</button>
  </nav>
</div>

<div id="app-parents" class="app-shell hidden">
  <header class="app-header">
    <button class="header-back" onclick="showPortal()"><svg><use href="#icon-back"/></svg></button>
    <img src="logo.png" alt="Logo" class="header-logo">
    <h1 class="header-title">Portal Familiar</h1>
  </header>
  <main class="app-main">
    <div class="level-card" style="background:linear-gradient(135deg,#06B6D4,#0891B2)">
      <div class="level-header">
        <div class="level-avatar">üë®‚Äçüë©‚Äçüëß</div>
        <div class="level-info"><h2>Familia Rodr√≠guez</h2><p>1 hijo/a inscripto</p></div>
      </div>
    </div>
    <section class="section">
      <div class="section-header"><h2 class="section-title"><svg><use href="#icon-users"/></svg>Progreso de Martina</h2></div>
      <div class="stats-grid">
        <div class="stat-card xp"><div class="stat-icon"><svg><use href="#icon-zap"/></svg></div><div class="stat-value">1,250</div><div class="stat-label">XP</div></div>
        <div class="stat-card recipes"><div class="stat-icon"><svg><use href="#icon-book"/></svg></div><div class="stat-value">12</div><div class="stat-label">Recetas</div></div>
        <div class="stat-card badges"><div class="stat-icon"><svg><use href="#icon-trophy"/></svg></div><div class="stat-value">8</div><div class="stat-label">Logros</div></div>
        <div class="stat-card"><div class="stat-icon"><svg><use href="#icon-star"/></svg></div><div class="stat-value">95%</div><div class="stat-label">Asistencia</div></div>
      </div>
    </section>
  </main>
</div>

<!-- ==================== RECIPE MODAL ==================== -->
<div id="recipe-modal" class="modal-overlay hidden" onclick="closeRecipeModal()">
  <div class="modal" onclick="event.stopPropagation()">
    <div class="modal-header">
      <h2 id="modal-title">Receta</h2>
      <button class="modal-close" onclick="closeRecipeModal()"><svg><use href="#icon-x"/></svg></button>
    </div>
    <div class="modal-body" id="modal-body"></div>
    <div class="modal-footer">
      <button class="btn btn-primary" onclick="completeRecipe()">üç≥ ¬°Preparar! <span style="opacity:0.8">+50 XP</span></button>
    </div>
  </div>
</div>

<!-- ==================== RECIPE FORM MODAL ==================== -->
<div id="form-modal" class="modal-overlay hidden" onclick="closeRecipeForm()">
  <div class="modal" onclick="event.stopPropagation()" style="max-height:95vh">
    <div class="modal-header">
      <h2>Nueva Receta</h2>
      <button class="modal-close" onclick="closeRecipeForm()"><svg><use href="#icon-x"/></svg></button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label>Nombre de la receta *</label>
        <input type="text" class="form-input" id="recipe-title" placeholder="Ej: Cupcakes de Vainilla">
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
        <div class="form-group">
          <label>Tiempo (min) *</label>
          <input type="number" class="form-input" id="recipe-time" placeholder="30">
        </div>
        <div class="form-group">
          <label>Puntos *</label>
          <input type="number" class="form-input" id="recipe-points" placeholder="50">
        </div>
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
        <div class="form-group">
          <label>Dificultad</label>
          <select class="form-input" id="recipe-difficulty">
            <option value="easy">F√°cil</option>
            <option value="medium">Medio</option>
            <option value="hard">Dif√≠cil</option>
          </select>
        </div>
        <div class="form-group">
          <label>Emoji</label>
          <input type="text" class="form-input" id="recipe-emoji" placeholder="üßÅ" maxlength="4">
        </div>
      </div>
      <div class="form-group">
        <label>Ingredientes * (uno por l√≠nea)</label>
        <textarea class="form-input" id="recipe-ingredients" rows="4" placeholder="2 tazas de harina&#10;1 taza de az√∫car&#10;2 huevos"></textarea>
      </div>
      <div class="form-group">
        <label>Pasos * (uno por l√≠nea)</label>
        <textarea class="form-input" id="recipe-steps" rows="4" placeholder="Precalentar el horno a 180¬∞C&#10;Mezclar ingredientes secos&#10;Hornear 25 minutos"></textarea>
      </div>
    </div>
    <div class="modal-footer" style="display:flex;gap:12px">
      <button class="btn btn-ghost" onclick="closeRecipeForm()" style="flex:1">Cancelar</button>
      <button class="btn btn-primary" onclick="saveRecipe()" style="flex:2">üíæ Guardar</button>
    </div>
  </div>
</div>

<!-- Toast -->
<div id="toast" class="toast"></div>

<script>
// ==================== SUPABASE ====================
const SUPABASE_URL = 'https://dukgjrhyhyxvdqzhthje.supabase.co';
const SUPABASE_KEY = 'sb_publishable_hdrC91CO7zGc3uoO2MsMVA_6K_CQmgd';

let db = null;
try {
  db = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
  console.log('‚úÖ Supabase conectado');
} catch(e) {
  console.log('‚ö†Ô∏è Sin conexi√≥n a Supabase');
}

// ==================== DATA ====================
let recipes = [];

const defaultRecipes = [
  {id:1, title:'Cupcakes de Vainilla', emoji:'üßÅ', time_minutes:30, difficulty:'easy', points:50, ingredients:['2 tazas harina','1 taza az√∫car','2 huevos','1/2 taza manteca'], steps:['Precalentar horno 180¬∞C','Mezclar secos','Agregar h√∫medos','Hornear 25 min']},
  {id:2, title:'Galletas con Chips', emoji:'üç™', time_minutes:25, difficulty:'easy', points:40, ingredients:['2 tazas harina','1 taza chips chocolate','1 huevo','Manteca'], steps:['Mezclar manteca y az√∫car','Agregar huevo','Incorporar harina y chips','Hornear 12 min']},
  {id:3, title:'Mini Pizzas', emoji:'üçï', time_minutes:45, difficulty:'medium', points:80, ingredients:['Masa','Salsa tomate','Mozzarella','Jam√≥n'], steps:['Estirar masa','Agregar salsa','Poner queso y toppings','Hornear 15 min']},
  {id:4, title:'Pancakes', emoji:'ü•û', time_minutes:20, difficulty:'easy', points:35, ingredients:['1 taza harina','1 huevo','1 taza leche','2 cdas az√∫car'], steps:['Mezclar todo','Cocinar en sart√©n','Dar vuelta al ver burbujas','Servir con miel']},
  {id:5, title:'Ensalada Arco√≠ris', emoji:'ü•ó', time_minutes:15, difficulty:'easy', points:30, ingredients:['Lechuga','Tomate','Zanahoria','Choclo'], steps:['Lavar verduras','Cortar','Mezclar','Agregar aderezo']},
  {id:6, title:'Tacos Caseros', emoji:'üåÆ', time_minutes:40, difficulty:'medium', points:70, ingredients:['Tortillas','Carne','Lechuga','Crema'], steps:['Cocinar carne','Picar verduras','Calentar tortillas','Armar tacos']}
];

const gradients = [
  'linear-gradient(135deg, #10B981, #059669)',
  'linear-gradient(135deg, #8B5CF6, #7C3AED)',
  'linear-gradient(135deg, #F59E0B, #D97706)',
  'linear-gradient(135deg, #EF4444, #DC2626)',
  'linear-gradient(135deg, #06B6D4, #0891B2)',
  'linear-gradient(135deg, #EC4899, #DB2777)'
];

// ==================== NAVIGATION ====================
function hideAll() {
  document.querySelectorAll('.portal, .login-screen, .app-shell, .modal-overlay').forEach(el => el.classList.add('hidden'));
}

function showPortal() {
  hideAll();
  document.getElementById('portal').classList.remove('hidden');
}

function showLogin(type) {
  hideAll();
  document.getElementById('login-' + type).classList.remove('hidden');
}

function login(type) {
  const nameInput = document.getElementById(type + '-name-input');
  const name = nameInput ? nameInput.value || 'Chef' : 'Chef';
  
  hideAll();
  document.getElementById('app-' + type).classList.remove('hidden');
  
  // Set player name
  const playerNameEl = document.getElementById('player-name');
  if (playerNameEl) playerNameEl.textContent = name;
  
  const teensNameEl = document.getElementById('teens-player-name');
  if (teensNameEl && type === 'teens') teensNameEl.textContent = name;
  
  loadRecipes();
}

// ==================== RECIPES ====================
async function loadRecipes() {
  try {
    if (db) {
      const { data, error } = await db.from('recipes').select('*').order('id');
      if (!error && data && data.length > 0) {
        recipes = data;
        console.log('‚úÖ Recetas de Supabase:', recipes.length);
      } else {
        recipes = defaultRecipes;
      }
    } else {
      recipes = defaultRecipes;
    }
  } catch(e) {
    recipes = defaultRecipes;
  }
  
  renderRecipes();
  updateCounts();
}

function renderRecipes() {
  const html = recipes.map((r, i) => `
    <div class="recipe-card" onclick="openRecipe(${r.id})" style="--recipe-color:${gradients[i % gradients.length].split(',')[1].split(')')[0]}">
      <div class="recipe-img" style="background:${gradients[i % gradients.length]}">
        <span class="recipe-emoji">${r.emoji || 'üçΩÔ∏è'}</span>
        <span class="recipe-badge ${r.difficulty}">${r.difficulty === 'easy' ? 'F√°cil' : r.difficulty === 'medium' ? 'Medio' : 'Dif√≠cil'}</span>
      </div>
      <div class="recipe-info">
        <h3>${r.title}</h3>
        <div class="recipe-meta">
          <svg><use href="#icon-clock"/></svg> ${r.time_minutes} min
        </div>
        <span class="recipe-xp">
          <svg style="width:14px;height:14px;stroke:#F59E0B"><use href="#icon-zap"/></svg>
          +${r.points} XP
        </span>
      </div>
    </div>
  `).join('');
  
  ['recipes-grid', 'docente-recipes-grid', 'teens-recipes-grid'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.innerHTML = html;
  });
}

function updateCounts() {
  const count = recipes.length;
  ['recipes-count', 'docente-recipes-count'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.textContent = count;
  });
}

function openRecipe(id) {
  const r = recipes.find(x => x.id === id || x.id === parseInt(id));
  if (!r) return;
  
  const idx = recipes.indexOf(r);
  document.getElementById('modal-title').textContent = r.title;
  
  const ingredients = Array.isArray(r.ingredients) ? r.ingredients : (r.ingredients || '').split('\n').filter(Boolean);
  const steps = Array.isArray(r.steps) ? r.steps : (r.steps || '').split('\n').filter(Boolean);
  
  document.getElementById('modal-body').innerHTML = `
    <div class="recipe-hero" style="background:${gradients[idx % gradients.length]}">
      <span class="recipe-emoji">${r.emoji || 'üçΩÔ∏è'}</span>
    </div>
    <div class="recipe-detail-meta">
      <div class="meta-item"><svg><use href="#icon-clock"/></svg> ${r.time_minutes} min</div>
      <div class="meta-item"><svg><use href="#icon-zap"/></svg> ${r.points} XP</div>
      <div class="meta-item"><svg><use href="#icon-star"/></svg> ${r.difficulty === 'easy' ? 'F√°cil' : r.difficulty === 'medium' ? 'Medio' : 'Dif√≠cil'}</div>
    </div>
    <h3 style="margin-bottom:12px;font-size:1rem">üìù Ingredientes</h3>
    <ul class="ingredient-list">
      ${ingredients.map(i => `<li class="ingredient-item"><div class="ingredient-check" onclick="this.classList.toggle('checked')"></div>${i}</li>`).join('')}
    </ul>
    <h3 style="margin:20px 0 12px;font-size:1rem">üë®‚Äçüç≥ Preparaci√≥n</h3>
    <ul class="step-list">
      ${steps.map((s, i) => `<li class="step-item"><div class="step-number">${i + 1}</div><div class="step-text">${s}</div></li>`).join('')}
    </ul>
  `;
  
  document.getElementById('recipe-modal').classList.remove('hidden');
}

function closeRecipeModal() {
  document.getElementById('recipe-modal').classList.add('hidden');
}

function completeRecipe() {
  showToast('üéâ ¬°Receta completada! +50 XP');
  closeRecipeModal();
}

// ==================== RECIPE FORM ====================
function openRecipeForm() {
  document.getElementById('form-modal').classList.remove('hidden');
}

function closeRecipeForm() {
  document.getElementById('form-modal').classList.add('hidden');
  // Clear form
  ['recipe-title', 'recipe-time', 'recipe-points', 'recipe-emoji', 'recipe-ingredients', 'recipe-steps'].forEach(id => {
    document.getElementById(id).value = '';
  });
}

async function saveRecipe() {
  const title = document.getElementById('recipe-title').value.trim();
  const time = parseInt(document.getElementById('recipe-time').value) || 30;
  const points = parseInt(document.getElementById('recipe-points').value) || 50;
  const difficulty = document.getElementById('recipe-difficulty').value;
  const emoji = document.getElementById('recipe-emoji').value || 'üçΩÔ∏è';
  const ingredients = document.getElementById('recipe-ingredients').value.trim();
  const steps = document.getElementById('recipe-steps').value.trim();
  
  if (!title) { showToast('‚ùå Ingres√° un nombre'); return; }
  if (!ingredients) { showToast('‚ùå Agreg√° ingredientes'); return; }
  if (!steps) { showToast('‚ùå Agreg√° los pasos'); return; }
  
  const newRecipe = {
    title,
    time_minutes: time,
    points,
    difficulty,
    emoji,
    category: 'general'
  };
  
  try {
    if (db) {
      const { data, error } = await db.from('recipes').insert(newRecipe).select().single();
      if (error) throw error;
      showToast('‚úÖ Receta guardada en Supabase');
    } else {
      newRecipe.id = Date.now();
      newRecipe.ingredients = ingredients.split('\n');
      newRecipe.steps = steps.split('\n');
      recipes.unshift(newRecipe);
      showToast('‚úÖ Receta guardada localmente');
    }
    
    await loadRecipes();
    closeRecipeForm();
  } catch(e) {
    console.error(e);
    showToast('‚ùå Error al guardar');
  }
}

// ==================== UTILS ====================
function showToast(msg) {
  const toast = document.getElementById('toast');
  toast.textContent = msg;
  toast.classList.add('show');
  setTimeout(() => toast.classList.remove('show'), 3000);
}

// ==================== INIT ====================
showPortal();
</script>
</body>
</html>
